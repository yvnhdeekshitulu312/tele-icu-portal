<app-header [InputHome]="true" [showAlert]="false" [IsSwitchWard]="false"></app-header>
<div class="page-header sticky-top shadow-sm justify-content-start">
    <h2 class="page-heading">EFORM Period</h2>
    <div class="actions ms-auto d-flex gap-2">
        <button class="btn btn-danger-outline" (click)="clearForm()">Clear</button>
        <button class="btn btn-main-outline" (click)="fetchData()">Search</button>
    </div>
</div>

<div class="p-3">
    <div class="d-flex align-items-center justify-content-end gap-3">
        <div class="clinical_toggle toggle__switch switch-sm d-inline-flex align-self-start">
            <button [class]="datesForm.get('location').value === '0' ? 'btn selected' : 'btn'"
                (click)="changeFilterLocation('0')">All</button>
            <button [class]="datesForm.get('location').value === '2' ? 'btn selected' : 'btn'"
                (click)="changeFilterLocation('2')">Suwaidi</button>
            <button [class]="datesForm.get('location').value === '3' ? 'btn selected' : 'btn'"
                (click)="changeFilterLocation('3')">Nuzha</button>
        </div>
        <div class="col-2">
            <button class="date_range_calendar p-0 position-relative">
                <mat-date-range-input class="btn btn-main-outline" [formGroup]="datesForm" [rangePicker]="picker">
                    <input matStartDate formControlName="fromdate">
                    <input matEndDate formControlName="todate" (dateChange)="fetchData()">
                </mat-date-range-input>
                <mat-datepicker-toggle matIconSuffix [for]="picker"></mat-datepicker-toggle>
                <mat-date-range-picker #picker></mat-date-range-picker>
            </button>
        </div>
        <div class="col-3">
            <div class="CommanSearch__form bg-grey-10 ps-0 position-relative">
                <input id="templateText" type="text" class="form-control pe-5" placeholder="Select Template"
                    autocomplete="off" [matAutocomplete]="template"
                    (keyup)="($event.key === 'ArrowUp' || $event.key === 'ArrowDown') ? $event.preventDefault() : searchTemplate($event)">
                <mat-autocomplete #template="matAutocomplete" (optionSelected)="onSelectTemplate($event)">
                    <mat-option *ngFor="let item of filteredFetchClinicalTemplatesNList"
                        [value]="item.ClinicalTemplateName">
                        {{item.ClinicalTemplateName}}
                    </mat-option>
                </mat-autocomplete>
                <label class="CommonSearch__label me-2 position-absolute end-0">
                    <img src="assets/images/icons/icon-search.svg" alt="">
                </label>
            </div>
        </div>
    </div>

    <div class="mt-2">
        <div class="fixed_alter_list rounded rounded-bottom-0 border-primary-200 eformPeriod_table">
            <div class="fixed_alter_header bg-primary-50 rounded-top">
                <div class="row gx-2 p-2 mx-0">
                    <div class="" style="width: 20%;">
                        <p class="label m-0">Patient Name</p>
                    </div>
                    <div class="" style="width: 10%;">
                        <p class="label m-0">SSN</p>
                    </div>
                    <div class="" style="width: 10%;">
                        <p class="label m-0">Mobile No</p>
                    </div>
                    <div class="" style="width: 10%;">
                        <p class="label m-0">Admit Date</p>
                    </div>
                    <div class="" style="width: 15%;">
                        <p class="label m-0">Eforms Name</p>
                    </div>
                    <div class="" style="width: 20%;">
                        <p class="label m-0">Saved By</p>
                    </div>
                    <div class="" style="width: 10%;">
                        <p class="label m-0">Saved Date</p>
                    </div>
                    <div class="" style="width: 5%;">
                        <p class="label m-0">Action</p>
                    </div>
                </div>
            </div>
            <div class="fixed_alter_body">
                <div class="row gx-2 p-2 mx-0 alter_div rounded-0"
                    *ngFor="let item of filteredData">
                    <div class="" style="width: 20%;">
                        <p class="m-0">{{item.PatientName}}</p>
                    </div>
                    <div class="" style="width: 10%;">
                        <p class="m-0">{{item.SSN}}</p>
                    </div>
                    <div class="" style="width: 10%;">
                        <p class="m-0">{{item.MobileNo}}</p>
                    </div>
                    <div class="" style="width: 10%;">
                        <p class="m-0">{{item.VisitDate}}</p>
                    </div>
                    <div class="" style="width: 15%;">
                        <p class="m-0">{{item.ClinicalTemplateName}}</p>
                    </div>
                    <div class="" style="width: 20%;">
                        <p class="m-0">{{item.CreatedByName}}</p>
                    </div>
                    <div class="" style="width: 10%;">
                        <p class="m-0">{{item.Createdate}}</p>
                    </div>
                    <div class="" style="width: 5%;">
                        <div class="custom_tooltip custom_tooltip_left" style="width: 1.8rem"
                            (click)="onViewClick(item)">
                            <svg xmlns="http://www.w3.org/2000/svg" width="25" height="17" viewBox="0 0 33 17"
                                fill="none">
                                <path
                                    d="M29.8223 5.08352C22.587 -1.67628 11.332 -1.67628 4.09666 5.08352L0.96167 8.01367L4.10173 10.9438C11.3371 17.7036 22.592 17.7036 29.8274 10.9438L32.9624 8.01367L29.8223 5.08352ZM16.9621 14.0137C13.6471 14.0137 10.9619 11.3287 10.9619 8.01349C10.9619 4.69824 13.6469 2.0133 16.9621 2.0133C20.2774 2.0133 22.9623 4.69824 22.9623 8.01349C22.9623 11.3287 20.2774 14.0137 16.9621 14.0137Z"
                                    fill="#43A9BC" />
                                <path
                                    d="M16.9621 4.01336C16.4021 4.01336 15.8671 4.12846 15.3821 4.33839C15.7323 4.61348 15.9622 5.03335 15.9622 5.51333C15.9622 6.33834 15.2873 7.01326 14.4623 7.01326C13.9823 7.01326 13.5623 6.7833 13.2874 6.43317C13.0772 6.91842 12.9621 7.45336 12.9621 8.01343C12.9621 10.2184 14.7571 12.0135 16.9622 12.0135C18.2522 12.0135 19.3923 11.3984 20.1273 10.4535C19.7422 10.3135 19.4623 9.94842 19.4623 9.51336C19.4623 8.96343 19.9123 8.51338 20.4623 8.51338C20.6223 8.51338 20.7772 8.55344 20.9123 8.62342C20.9422 8.42338 20.9623 8.2185 20.9623 8.01338C20.9623 5.80835 19.1672 4.01336 16.9621 4.01336Z"
                                    fill="#43A9BC" />
                            </svg>
                            <div class="tooltip">
                                <p class="label text-nowrap m-0 lh-1">View</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="modal" id="errorMessagesModal" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered modal-toast modal-toast-success">
        <div class="modal-content">
            <img class="modal-header-icon" src="assets/images/icons/toast-info.svg" alt="">
            <div class="modal-body">
                <p *ngIf="errorMessages.length === 1">{{errorMessages[0]}}</p>
                <ul *ngIf="errorMessages.length > 1">
                    <li *ngFor="let error of errorMessages; let i = index"> {{error}}</li>
                </ul>
                <div class="modal-footer">
                    <a href="javascript:void(0)" type="button" class="btn btn-main-outline"
                        data-bs-dismiss="modal">{{langData?.common?.ok}}</a>
                </div>
            </div>
        </div>
    </div>
</div>