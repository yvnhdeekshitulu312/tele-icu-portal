<app-suit-header [IsSwitchWard]="true"></app-suit-header>
<!--Container-->
<div class="container__wrapper bg-white">
    <div class="page-header sticky-top shadow-sm">
        <h2 class="page-heading">Medical Secretary SickLeave Approval Worklist</h2>
        <div class="actions ms-auto gap-2 d-flex align-items-center">

        </div>
    </div>

    <div class="d-flex align-items-center justify-content-between p-2 border-bottom">
        <form class="d-flex align-items-center gap-2" [formGroup]="datesForm">
            <div class="d-flex align-items-center gap-2">
                <label for="" class="form-label text-nowrap">Date :</label>
                <div class="d-flex align-items-center gap-2 justify-content-end">
                    <button class="date_range_calendar p-0 position-relative" style="width: 227px;">
                        <mat-date-range-input class="btn btn-main-outline" [rangePicker]="picker">
                            <input matStartDate formControlName="fromdate">
                            <input matEndDate formControlName="todate" (dateChange)="FetchSickLeaveApprovals()">
                        </mat-date-range-input>
                        <mat-datepicker-toggle matIconSuffix [for]="picker"></mat-datepicker-toggle>
                        <mat-date-range-picker #picker></mat-date-range-picker>
                    </button>
                </div>
                <div class="CommanSearch__form">
                    <label for="" class="CommonSearch__label">
                        <img src="assets/images/icons/icon-search.svg" alt="">
                    </label>
                    <input class="CommonSearch__input form-control" type="text" formControlName="SSN" placeholder="SSN"
                        (keypress)="($event.charCode >= 48 && $event.charCode < 58)"
                        (keydown.enter)="onSSNEnterPress($event)">
                    <button type="button" class="reset-btn" (click)="onSSNClearClick()">
                        <svg width="20" height="20" viewBox="0 0 20 20">
                            <path d="M10 10l5.09-5.09L10 10l5.09 5.09L10 10zm0 0L4.91 4.91 10 10l-5.09 5.09L10 10z"
                                stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round"
                                stroke-linejoin="round"></path>
                        </svg>
                    </button>
                </div>
                <div class="CommanSearch__form ps-0 position-relative" style="width: 18rem;">
                    <input type="text" class="form-control pe-5" placeholder="Specialisation" autocomplete="off"
                        formControlName="Specialisation" aria-label="Specialisation"
                        [matAutocomplete]="autoSpecialisation"
                        (keyup)="($event.key === 'ArrowUp' || $event.key === 'ArrowDown') ? $event.preventDefault() : searchSpecItem($event)">
                    <mat-autocomplete #autoSpecialisation="matAutocomplete"
                        (optionSelected)="selectSpecialisationItem($event)">
                        <mat-option *ngFor="let item of listOfSpecialisation" [value]="item.Specialisation">
                            {{item.Specialisation}}
                        </mat-option>
                    </mat-autocomplete>
                    <svg class="me-2" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 25 24"
                        fill="none">
                        <g clip-path="url(#clip0_72_1908)">
                            <path
                                d="M11.0835 2.00003C16.0515 2.00003 20.0835 6.03203 20.0835 11C20.0835 15.968 16.0515 20 11.0835 20C6.1155 20 2.0835 15.968 2.0835 11C2.0835 6.03203 6.1155 2.00003 11.0835 2.00003ZM11.0835 18C14.9505 18 18.0835 14.867 18.0835 11C18.0835 7.13203 14.9505 4.00003 11.0835 4.00003C7.2155 4.00003 4.0835 7.13203 4.0835 11C4.0835 14.867 7.2155 18 11.0835 18ZM19.5685 18.071L22.3975 20.899L20.9825 22.314L18.1545 19.485L19.5685 18.071V18.071Z"
                                fill="#368796" />
                        </g>
                    </svg>
                </div>
                <div class="CommanSearch__form ps-0 w-25 position-relative">
                    <input type="text" class="form-control pe-5" placeholder="Doctor" autocomplete="off" id="txtDoctor"
                        formControlName="DoctorName" aria-label="Doctor" [matAutocomplete]="autoDoctor"
                        (keyup)="($event.key === 'ArrowUp' || $event.key === 'ArrowDown') ? $event.preventDefault() : searchDoctor($event)">
                    <mat-autocomplete #autoDoctor="matAutocomplete" (optionSelected)="selectDocor($event)">
                        <mat-option *ngFor="let item of listOfItems" [value]="item.EmpCodeName">
                            {{item.EmpCodeName}}-{{item.SpecialityName}}
                        </mat-option>
                    </mat-autocomplete>
                    <svg class="me-2" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 25 24"
                        fill="none">
                        <g clip-path="url(#clip0_72_1908)">
                            <path
                                d="M11.0835 2.00003C16.0515 2.00003 20.0835 6.03203 20.0835 11C20.0835 15.968 16.0515 20 11.0835 20C6.1155 20 2.0835 15.968 2.0835 11C2.0835 6.03203 6.1155 2.00003 11.0835 2.00003ZM11.0835 18C14.9505 18 18.0835 14.867 18.0835 11C18.0835 7.13203 14.9505 4.00003 11.0835 4.00003C7.2155 4.00003 4.0835 7.13203 4.0835 11C4.0835 14.867 7.2155 18 11.0835 18ZM19.5685 18.071L22.3975 20.899L20.9825 22.314L18.1545 19.485L19.5685 18.071V18.071Z"
                                fill="#368796" />
                        </g>
                    </svg>
                </div>
            </div>
            <div class="d-flex align-items-center gap-2">
                <button class="btn btn-danger-outline" (click)="clearSickLeaveApprovals()">Clear</button>
                <button class="btn btn-main-outline" (click)="FetchSickLeaveApprovals()">Search</button>
            </div>

        </form>
        <div class="admission_legends d-flex align-items-center gap-3">
            <div class="d-flex align-items-center gap-1 newReq">
                <span class=""></span>
                <label for="" class="form-label m-0">New Request</label>
            </div>
            <div class="d-flex align-items-center gap-1 admitted">
                <span class=""></span>
                <label for="" class="form-label m-0">Approved</label>
            </div>
        </div>
    </div>

    <div class="p-2 pb-0">
        <div class="nobulkprocess d-flex flex-column align-items-center justify-content-center" *ngIf="showNoRecFound">
            <img src="assets/images/icon-no-appointments.svg" alt="" class="mb-2">
            <p class="m-0 fs-6">No Requests for the Day</p>
        </div>

        <div class="adm_req_doctors" *ngIf="!showNoRecFound">
            <div *ngFor="let data of sortedGroupedByAdmitDate">
                <div class="card card-style-1 rounded group-date p-0 border-0 mt-1">
                    <div class="card-header rounded-top justify-content-start p-0 min-height-unset p-0">
                        <span class="d-block grp_date">{{ data.admitDate }}</span>
                    </div>
                    <div [class]="item.OPDManagerApprovedUserID == '' ? 'doctor_worklist my-1 cursor-pointer newReq worklist_patientcard rounded-2' : 'doctor_worklist my-1 cursor-pointer admitted worklist_patientcard rounded-2 my-1'"
                        *ngFor="let item of data.items; let i=index">
                        <div class="row mx-0">
                            <div class="col-md-12 p-0">
                                <div class="row mx-0 gx-2 p-1">
                                    <div class="col-lg-3" style="width: 22rem;">
                                        <div class="d-flex align-items-center h-100">
                                            <div class="patient-photo me-3">
                                                <img *ngIf="item.GenderID == 1" src="assets/images/icons/male.svg"
                                                    alt="" class="position-relative">
                                                <img *ngIf="item.GenderID == 2" src="assets/images/icons/female.svg"
                                                    alt="" class="position-relative">
                                            </div>
                                            <div class="mt-1">
                                                <p class="value fs-7 fw-bold w-100">{{item.PatientName}}</p>
                                                <div class="d-flex align-items-center gap-2">
                                                    <p>{{item.Gender}} | {{item.FullAge}} </p>
                                                    <p><b>ID No.</b> : {{ item.SSN }}</p>
                                                </div>
                                                <div class="d-flex align-items-center gap-1">
                                                    <p><b>DOB</b> :</p>
                                                    <svg width="10" height="11" viewBox="0 0 10 11" fill="none"
                                                        xmlns="http://www.w3.org/2000/svg">
                                                        <path
                                                            d="M8.26322 1.3606H7.69641V0.965985C7.69641 0.799562 7.6061 0.645704 7.45953 0.562492C7.31306 0.479173 7.13244 0.479173 6.98598 0.562492C6.8394 0.645704 6.7491 0.799559 6.7491 0.965985V1.36049L3.25071 1.3606V0.965983C3.25071 0.799559 3.16041 0.645701 3.01383 0.56249C2.86736 0.47917 2.68674 0.47917 2.54028 0.56249C2.3937 0.645701 2.3034 0.799557 2.3034 0.965983V1.36049L1.73659 1.3606C1.27604 1.3606 0.834325 1.54056 0.508675 1.86095C0.182912 2.18145 0 2.61604 0 3.06915V8.79133C0 9.24445 0.18292 9.67904 0.508675 9.99954C0.834325 10.3199 1.27604 10.5 1.73659 10.5H8.26341C8.72396 10.5 9.16568 10.3199 9.49133 9.99954C9.81709 9.67904 10 9.24445 10 8.79133V3.06915C10 2.61604 9.81708 2.18145 9.49133 1.86095C9.16568 1.54056 8.72396 1.3606 8.26341 1.3606L8.26322 1.3606ZM1.73809 2.29263H2.3049V2.99787L2.30479 2.99776C2.30479 3.16419 2.39509 3.31805 2.54167 3.40126C2.68825 3.48458 2.86876 3.48458 3.01533 3.40126C3.1618 3.31805 3.2521 3.16419 3.2521 2.99776V2.29252H6.74908V2.99776C6.74908 3.16419 6.83939 3.31805 6.98596 3.40126C7.13243 3.48458 7.31305 3.48458 7.45951 3.40126C7.60609 3.31805 7.69639 3.16419 7.69639 2.99776V2.29252H8.2632C8.47255 2.29252 8.67331 2.37432 8.82132 2.52005C8.96933 2.66567 9.05259 2.86319 9.05259 3.06916V4.48268H0.947001V3.06916C0.947001 2.86319 1.03026 2.66567 1.17827 2.52005C1.32628 2.37432 1.52703 2.29252 1.73639 2.29252L1.73809 2.29263ZM8.26322 9.56809H1.7364C1.52705 9.56809 1.32629 9.48629 1.17828 9.34067C1.03027 9.19494 0.947012 8.99742 0.947012 8.79144V5.41472H9.0526V8.79144C9.0526 8.99742 8.96934 9.19494 8.82133 9.34067C8.67332 9.48629 8.47257 9.56809 8.26321 9.56809H8.26322Z"
                                                            fill="#368796" />
                                                    </svg>
                                                    <p class="m-0 fw-bold text-nowrap">
                                                        {{item.DOB?.split('
                                                        ')[0]}}</p>
                                                </div>
                                                <p>{{item.Nationality}} | Mobile : {{item.MobileNo}}</p>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col pe-0">
                                        <div class="bg-white h-100 p-1 rounded-2 d-flex gap-2">
                                            <div class="row mx-0 pb-1 w-100 gx-2">
                                                <div class="col-3" style="width: 16%;">
                                                    <label for="" class="form-label m-0 fw-bold">Doctor Name</label>
                                                    <p class="text-wrap fs-8">{{item.DoctorName}}</p>
                                                </div>
                                                <div class="col-2" style="width: 13%;">
                                                    <label for="" class="form-label m-0 fw-bold">Specialisation</label>
                                                    <p class="text-truncate fs-8">{{item.Specialisation}}</p>
                                                </div>
                                                <div class="col-2" style="width: 13%;">
                                                    <label for="" class="form-label m-0 fw-bold">RequestDate</label>
                                                    <p class="text-truncate fs-8">{{item.CreateDate}}</p>
                                                </div>
                                                <div class="col-2">
                                                    <label for="" class="form-label m-0 fw-bold">SickLeave From</label>
                                                    <p class="text-truncate fs-8">{{item.FromDate}}|{{item.ToDate}}</p>
                                                </div>
                                                <div class="col-2" style="width: 11%;">
                                                    <label for="" class="form-label m-0 fw-bold">Extend Days</label>
                                                    <p class="text-truncate fs-8">{{item.ExtendSickleaveDays}} Days</p>
                                                </div>
                                                <div class="col-2" style="width: 13%;">
                                                    <label for="" class="form-label m-0 fw-bold">OPD Manager</label>
                                                    <p class="text-truncate fs-8">{{item.OPDManagerApprovedUserName}}
                                                    </p>
                                                </div>
                                                <div class="col-2" style="width: 17%;">
                                                    <label for="" class="form-label m-0 fw-bold">OPD Manager Approved
                                                        Date</label>
                                                    <p class="text-truncate fs-8">{{item.OPDManagerApprovedDate}} </p>
                                                </div>

                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div
                                    class="p-1 rounded-bottom doctor_worklist_ChiefComplaints d-flex align-items-center gap-2 justify-content-between">
                                    <p><b class="fs-8">Remarks : </b>{{item.ExtendSickleaveRemarks}}</p>
                                    <div class="d-flex align-items-center gap-2">
                                        <!-- <div class="inline_legend pe-2 d-flex gap-3">
                                            <span class="legend fs-8 text-nowrap"
                                                *ngIf="item.MedicalSecApprovedUserID">Approved</span>
                                            <span class="legend fs-8 text-nowrap"
                                                *ngIf="!item.MedicalSecApprovedUserID" (click)="onApproveClick(item)">Approve</span>
                                        </div> -->
                                        <div class="inline_legend pe-2 d-flex gap-3">
                                            <span class="legend fs-8 text-nowrap" style="background-color: #6877ca;"
                                                (click)="PrintSickLeave(item)"
                                                *ngIf="item.OPDManagerApprovedUserID != ''">Print</span>
                                            <span class="legend fs-8 text-nowrap d-none"
                                                *ngIf="item.MedicalSecApprovedUserID != ''">Approved</span>
                                            <span class="legend fs-8 text-nowrap"
                                                *ngIf="item.OPDManagerApprovedUserID == ''"
                                                (click)="onApproveClick(item)">New Request</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="sickLeaveApprovalModal">
    <div class="modal-dialog modal-dialog-centered" style="width: 35%;">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">
                    Sick Leave Approve
                </h5>
                <div class="d-flex gap-2 align-items-center justify-content-end">
                    <button class="btn btn-main-outline" (click)="saveApproval()"
                        [disabled]="!approvalForm?.valid">Approve</button>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
            </div>
            <div class="modal-body" [formGroup]="approvalForm" *ngIf="selectedItem">
                <div class="d-flex gap-3">
                    <div class="d-flex gap-2 mb-2">
                        <p class="fw-bold">No. of Days</p>
                        <p>{{selectedItem.ExtendSickleaveDays}}</p>
                    </div>
                    <div class="d-flex gap-2 mb-2">
                        <p class="fw-bold">From Date:</p>
                        <p>{{selectedItem.FromDate}}</p>
                    </div>
                    <div class="d-flex gap-2 mb-2">
                        <p class="fw-bold">To Date:</p>
                        <p>{{selectedItem.ToDate}}</p>
                    </div>
                </div>

                <div class="d-flex gap-2 mb-2">
                    <p class="fw-bold">Sick Leave Remarks:</p>
                    <p>{{selectedItem.ExtendSickleaveRemarks}}</p>
                </div>
                <div class="d-flex gap-2 mb-2">
                    <p class="fw-bold">OPD Remarks:</p>
                    <p>{{selectedItem.OPDManagerApprovedORRejectedRemarks}}</p>
                </div>
                <textarea name="" placeholder="Enter Remarks" class="form-control resize-none mb-2"
                    formControlName="remarks" id="" cols="30" rows="3"></textarea>
            </div>
        </div>
    </div>
</div>

<div class="modal" id="approvalSaveMsg" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered modal-toast modal-toast-success">
        <div class="modal-content">
            <img class="modal-header-icon" src="assets/images/icons/toast-success.svg" alt="">
            <div class="modal-body">
                <p>Approved Successfully</p>
                <div class="modal-footer">
                    <a href="javascript:void(0)" type="button" class="btn btn-main-outline"
                        data-bs-dismiss="modal">{{langData?.common?.ok}}</a>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="modal" id="reviewAndPayment">
    <div class="modal-dialog  modal-xl">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">{{langData?.common?.radReport}}</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"
                    (click)="trustedUrl = ''"></button>
            </div>
            <div class="modal-body">
                <iframe *ngIf="trustedUrl" height="600" width="100%" [src]="(trustedUrl ? trustedUrl :'')| safeUrl"
                    frameborder="0"></iframe>
            </div>
        </div>
    </div>
</div>