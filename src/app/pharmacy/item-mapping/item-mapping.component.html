<div class="container__wrapper bg-white">
    <div class="page-header sticky-top shadow-sm justify-content-between">
        <h2 class="page-heading">Item Mapping</h2>
        <div class="d-flex align-item-center justify-content-end gap-2">
            <button class="btn btn-main-outline" (click)="onSaveClick()">Save</button>
            <button class="btn btn-danger-outline" (click)="onClearClick()">Clear</button>
        </div>
    </div>
    <div class="p-2">
        <div class="row g-2">
            <div class="col-2">
                <label for="" class="form-label">Location</label>
                <select name="" class="form-select pe-4" [(ngModel)]="selectedLocation" (change)="onLocationChange()">
                    <option value="0">Select</option>
                    <option *ngFor="let loc of locationsList" [value]="loc.HospitalID">{{loc.Name}}</option>
                </select>
            </div>
            <div class="col-2" *ngIf="isIndividualMapping">
                <label for="" class="form-label">Department</label>
                <select name="" class="form-select pe-4" [(ngModel)]="selectedDepartment"
                    (change)="onFromDepartmentChange()">
                    <option value="0">Select</option>
                    <option *ngFor="let dept of departmentsList" [value]="dept.FacHospDeptID">{{dept.WorkPlaceName}}
                    </option>
                </select>
            </div>
            <div class="col-2" *ngIf="!isIndividualMapping">
                <label for="" class="form-label">From Dept</label>
                <select name="" class="form-select pe-4" [(ngModel)]="selectedFromDepartment"
                    (click)="onFromDepartmentChange()">
                    <option value="0">Select</option>
                    <option *ngFor="let dept of departmentsList" [value]="dept.FacHospDeptID">{{dept.WorkPlaceName}}
                    </option>
                </select>
            </div>
            <div class="col-2" *ngIf="!isIndividualMapping">
                <label for="" class="form-label">To Dept</label>
                <select name="" class="form-select pe-4" [(ngModel)]="selectedToDepartment">
                    <option value="0">Select</option>
                    <option *ngFor="let dept of departmentsList" [value]="dept.FacHospDeptID">{{dept.WorkPlaceName}}
                    </option>
                </select>
            </div>
            <div class="col d-flex align-items-center justify-content-end gap-2">
                <div class="clinical_toggle toggle__switch switch-sm d-inline-flex">
                    <button class="btn" [class.selected]="isIndividualMapping"
                        (click)="onIndividualMappingChange(true)">Individual Mapping</button>
                    <button class="btn" [class.selected]="!isIndividualMapping"
                        (click)="onIndividualMappingChange(false)">Bulk Mapping</button>
                </div>
                <div class="clinical_toggle toggle__switch switch-sm d-inline-flex" *ngIf="isIndividualMapping">
                    <button class="btn" [class.selected]="isMappingItems" (click)="onMappingItemsChange(true)">Mapping
                        Items</button>
                    <button class="btn" [class.selected]="!isMappingItems"
                        (click)="onMappingItemsChange(false)">Un-Mapping
                        Items(s)</button>
                </div>
            </div>
        </div>
        <div class="row gx-2 mt-3 speciality_switch">
            <div class="col-5" style="width: 47%;">
                <div class="card card-style-1 rounded">
                    <div class="card-header rounded-top justify-content-between min-height-unset">
                        <div class="d-flex align-items-center gap-2">
                            <label for="" class="form-label">Category</label>
                            <select name="" class="form-select pe-4" style="width: 12rem;"
                                [(ngModel)]="selectedCategory" (click)="onCategoryChange()">
                                <option value="0">All</option>
                                <option *ngFor="let cat of categoriesList" [value]="cat.CategoryID">{{cat.CategoryName}}
                                </option>
                            </select>
                        </div>
                        
                        <button class="btn btn-main-outline" (click)="viewAllMappedItemsClick()"
                            *ngIf="!isIndividualMapping">View All Mapped
                            items</button>

                        <button class="btn btn-main-outline" (click)="viewMappedItemsClick()"
                            *ngIf="isIndividualMapping">
                            <span *ngIf="isMappingItems">View All Unmapped Items</span>
                            <span *ngIf="!isMappingItems">View All Mapped Items</span>
                        </button>
                    </div>
                    <div class="p-2">
                        <div class="border speciality_switch_box rounded-2">
                            <div class="p-2 d-flex flex-column align-items-center gap-2 switch_box_body">
                                <div *ngFor="let item of viewMappedItems; let i = index" class=" row align-items-center mx-0 p-2 hoverelement cursor-pointer rounded-1
                                    w-100">
                                    <div class="col-12">
                                        <p class="m-0">{{item.Displayname}}</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-2" style="width: 6%;" *ngIf="isIndividualMapping">
                <div class="h-100 d-flex flex-column align-items-center justify-content-center gap-2">
                    <svg class="toright cursor-pointer disabled" width="40" height="40" viewBox="0 0 33 33" fill="none"
                        xmlns="http://www.w3.org/2000/svg">
                        <rect x="28.3901" y="28.7678" width="24" height="24" rx="4"
                            transform="rotate(-180 28.3901 28.7678)" fill="#43A9BC" />
                        <path fill-rule="evenodd" clip-rule="evenodd"
                            d="M16.3901 17.3103L20.1614 13.5391L22.047 15.4247L16.3901 21.0815L10.7333 15.4247L12.6189 13.5391L16.3901 17.3103Z"
                            fill="white" />
                    </svg>

                    <svg class="toleft cursor-pointer" width="40" height="40" viewBox="0 0 33 33" fill="none"
                        xmlns="http://www.w3.org/2000/svg">
                        <rect x="28.3901" y="28.7678" width="24" height="24" rx="4"
                            transform="rotate(-180 28.3901 28.7678)" fill="#43A9BC" />
                        <path fill-rule="evenodd" clip-rule="evenodd"
                            d="M16.3901 17.3103L20.1614 13.5391L22.047 15.4247L16.3901 21.0815L10.7333 15.4247L12.6189 13.5391L16.3901 17.3103Z"
                            fill="white" />
                    </svg>
                </div>
            </div>
            <div class="col-5" style="width: 47%;" *ngIf="isIndividualMapping">
                <div class="card card-style-1 rounded">
                    <div class="card-header rounded-top justify-content-start min-height-unset">
                        <div class="d-flex input-group w-50">
                            <input type="text" class="form-control" disabled placeholder="Select Items to Map" *ngIf="isMappingItems">
                            <input type="text" class="form-control" disabled placeholder="Select Items to UnMap" *ngIf="!isMappingItems">

                              


                            <button type="button" class="btn btn-secondary-fill btn-icon"
                                (click)="openItemSearchModal()">
                                <img src="assets/images/icons/icon-search.svg" alt="">
                            </button>
                        </div>
                    </div>
                    <div class="p-2">
                        <div class="border speciality_switch_box rounded-2">
                            <div class="p-2 d-flex flex-column align-items-center gap-2 switch_box_body">
                                <div *ngFor="let item of mappedItemsList; let i = index" class=" row align-items-center mx-0 p-2 hoverelement cursor-pointer rounded-1
                                    w-100">
                                    <div class="col-10">
                                        <p class="m-0">{{item.DisplayName}}</p>
                                    </div>
                                    <div class="col-2">
                                        <div class="del_svg cursor-pointer custom_tooltip"
                                            (click)="deleteMappedItem(i)">
                                            <svg width="23" height="22" viewBox="0 0 23 22" fill="none"
                                                xmlns="http://www.w3.org/2000/svg">
                                                <path
                                                    d="M20.0995 6.16917H20.0261C15.177 5.68334 10.337 5.5 5.5428 5.98584L3.6728 6.16917C3.58184 6.17866 3.48989 6.17003 3.40228 6.14377C3.31467 6.11751 3.23314 6.07414 3.16239 6.01618C3.09164 5.95822 3.03308 5.8868 2.9901 5.80607C2.94712 5.72534 2.92056 5.63689 2.91197 5.54584C2.8753 5.16084 3.1503 4.83084 3.52614 4.79417L5.39614 4.61084C10.2728 4.11584 15.2136 4.30834 20.1636 4.79417C20.5395 4.83084 20.8145 5.17 20.7778 5.54584C20.764 5.71605 20.6864 5.87477 20.5607 5.99032C20.4349 6.10586 20.2702 6.16973 20.0995 6.16917Z"
                                                    fill="#EB6247"></path>
                                                <path
                                                    d="M8.64147 5.24333C8.6048 5.24333 8.56813 5.24333 8.5223 5.23416C8.34445 5.20211 8.18627 5.10159 8.08172 4.95419C7.97717 4.80679 7.93459 4.62427 7.96313 4.44583L8.1648 3.24499C8.31147 2.36499 8.51313 1.14583 10.649 1.14583H13.0506C15.1956 1.14583 15.3973 2.41083 15.5348 3.25416L15.7365 4.44583C15.8006 4.82166 15.544 5.17916 15.1773 5.23416C14.8015 5.29833 14.444 5.04166 14.389 4.67499L14.1873 3.48333C14.059 2.68583 14.0315 2.52999 13.0598 2.52999H10.6581C9.68647 2.52999 9.66813 2.65833 9.53063 3.47416L9.3198 4.66583C9.29369 4.82694 9.2111 4.97351 9.08683 5.07931C8.96255 5.18512 8.80468 5.24325 8.64147 5.24333ZM14.7923 20.856H8.9073C5.70813 20.856 5.5798 19.0868 5.47897 17.6568L4.88313 8.42599C4.85563 8.05016 5.14897 7.72016 5.5248 7.69266C5.9098 7.67433 6.23063 7.95849 6.25813 8.33433L6.85397 17.5652C6.9548 18.9585 6.99147 19.481 8.9073 19.481H14.7923C16.7173 19.481 16.754 18.9585 16.8456 17.5652L17.4415 8.33433C17.469 7.95849 17.799 7.67433 18.1748 7.69266C18.5506 7.72016 18.844 8.041 18.8165 8.42599L18.2206 17.6568C18.1198 19.0868 17.9915 20.856 14.7923 20.856Z"
                                                    fill="#EB6247"></path>
                                                <path
                                                    d="M13.3714 15.8125H10.3189C9.94311 15.8125 9.63144 15.5008 9.63144 15.125C9.63144 14.7492 9.94311 14.4375 10.3189 14.4375H13.3714C13.7473 14.4375 14.0589 14.7492 14.0589 15.125C14.0589 15.5008 13.7473 15.8125 13.3714 15.8125ZM14.1414 12.1458H9.55811C9.18227 12.1458 8.87061 11.8342 8.87061 11.4583C8.87061 11.0825 9.18227 10.7708 9.55811 10.7708H14.1414C14.5173 10.7708 14.8289 11.0825 14.8289 11.4583C14.8289 11.8342 14.5173 12.1458 14.1414 12.1458Z"
                                                    fill="#EB6247"></path>
                                            </svg>
                                            <div class="tooltip">
                                                <p>Delete</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="modal" id="itemSearchModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" style="max-width:90rem">
        <div class="modal-content">
            <div class="modal-header p-2 gap-3">
                <h5 class="modal-title clr-primary-600 fs-6 text-nowrap" translate>Select Items to Map</h5>
                <div class="d-flex align-items-center gap-2">
                    <button class="btn btn-main-outline" (click)="loadSelectedMultiItems()">Select</button>
                    <button type="button" data-bs-dismiss="modal" aria-label="Close" class="btn-close"></button>
                </div>
            </div>
            <div class="modal-body p-2">
                <div class="d-flex justify-content-between align-items-center">
                    <div class="d-flex gap-2 w-100">
                        <div class="d-flex flex-column">
                            <label for="" class="form-label w-50">Item Code</label>
                            <div class="d-flex align-items-center gap-2">
                                <div class="input-group">
                                    <select name="" class="form-select pe-5" [(ngModel)]="itemCodeFilterType">
                                        <option *ngFor="let item of filterTypeList" [value]="item.id">
                                            {{item.label}}
                                        </option>
                                    </select>
                                </div>
                                <input type="text" class="form-control" placeholder="Code" [(ngModel)]="itemCodeSearchText"
                                    (keydown.enter)="fetchItems()">
                            </div>
                        </div>
                        <div class="d-flex flex-column">
                            <label for="" class="form-label w-50">Item Name</label>
                            <div class="d-flex gap-2 align-items-center">
                                <div class="input-group">
                                    <select name="" class="form-select pe-5" [(ngModel)]="itemNameFilterType">
                                        <option *ngFor="let item of filterTypeList" [value]="item.id">
                                            {{item.label}}
                                        </option>
                                    </select>
                                </div>
                                <input type="text" class="form-control" placeholder="Name" [(ngModel)]="itemNameSearchText"
                                    (keydown.enter)="fetchItems()">
                            </div>
                        </div>
                        <div class="d-flex flex-column">
                            <label for="" class="form-label w-50">Category</label>
                            <div class="d-flex gap-2 align-items-center">
                                <div class="input-group">
                                    <select name="" class="form-select pe-5" [(ngModel)]="categoryFilterType">
                                        <option *ngFor="let item of filterTypeList" [value]="item.id">
                                            {{item.label}}
                                        </option>
                                    </select>
                                </div>
                                <input type="text" class="form-control" placeholder="Name" [(ngModel)]="categorySearchText"
                                    (keydown.enter)="fetchItems()">
                            </div>
                        </div>
                    </div>
                    <div class="d-flex mt-2 gap-2 justify-content-end">
                        <button class="btn btn-danger-outline" (click)="clearSearch()">Clear</button>
                        <button class="btn btn-main-outline" (click)="fetchItems()">Search</button>
                    </div>
                </div>
                <div class="custom_check d-flex align-items-center gap-1 mt-2" [class.active]="showSelectedMultipleItems"
                    (click)="showSelectedMultipleItemsClick()">
                    <svg width="17" height="17" viewBox="0 0 20 21" fill="none" xmlns="http://www.w3.org/2000/svg"
                        class="check_svg">
                        <circle cx="10" cy="10.5" r="10" fill="#43BC94"></circle>
                        <path
                            d="M9.85969 13.8389C10.1922 13.8374 10.5109 13.7054 10.747 13.4712L10.747 13.4713L10.7496 13.4685L18.7068 5.08439C18.825 4.96682 18.9188 4.8271 18.9829 4.67321C19.0473 4.51873 19.0804 4.35303 19.0804 4.18568C19.0804 4.01832 19.0473 3.85262 18.9829 3.69814C18.9186 3.5437 18.8243 3.40352 18.7055 3.28569C18.468 3.04958 18.1467 2.91704 17.8118 2.91704C17.4769 2.91704 17.1556 3.04958 16.918 3.28569L16.918 3.28564L16.9152 3.28862L9.85639 10.7804L8.06528 8.98932C7.95221 8.85834 7.81352 8.75187 7.65773 8.67649C7.50045 8.6004 7.32913 8.55764 7.15455 8.5509C6.97996 8.54416 6.80586 8.57357 6.64318 8.63731C6.4805 8.70104 6.33274 8.79771 6.2092 8.92126C6.08565 9.04481 5.98898 9.19256 5.92524 9.35524C5.86151 9.51792 5.83209 9.69202 5.83884 9.86661C5.84558 10.0412 5.88834 10.2125 5.96443 10.3698C6.03979 10.5255 6.14622 10.6642 6.27716 10.7773L8.95915 13.4707L8.9597 13.4712C9.07816 13.5887 9.21864 13.6817 9.3731 13.7447C9.52752 13.8078 9.69288 13.8398 9.85969 13.8389ZM9.85969 13.8389C9.85965 13.8389 9.85962 13.8389 9.85959 13.8389L9.85906 13.7139L9.85978 13.8389C9.85975 13.8389 9.85972 13.8389 9.85969 13.8389Z"
                            fill="white" stroke="white" stroke-width="0.25"></path>
                    </svg>
                    <p>Show Selected Items</p>
                </div>
                <div class="mt-3" *ngIf="!showSelectedMultipleItems">
                    <div class="fixed_alter_list rounded border-primary-200 SelectedMultipleItems_table">
                        <div class="fixed_alter_header bg-primary-100">
                            <div class="row gx-2 mx-0 p-2">
                                <div class="col-1" style="width: 3%;"></div>
                                <div class="col-4">
                                    <p class="label m-0">Item Name</p>
                                </div>
                                <div class="col-3">
                                    <p class="label m-0">Item Code</p>
                                </div>
                                <div class="col-4">
                                    <p class="label m-0">Category Name</p>
                                </div>
                            </div>
                        </div>
                        <div class="fixed_alter_body">
                            <div class="row gx-2 mx-0 p-2 alter_div" *ngFor="let item of multiItemsList;let i=index">
                                <div class="col-1" style="width: 3%;">
                                    <div class="custom_check d-flex align-items-center justify-content-center"
                                        [class.active]="item.selected" (click)="selectMultiItem(item)">
                                        <svg width="17" height="17" viewBox="0 0 20 21" fill="none"
                                            xmlns="http://www.w3.org/2000/svg" class="check_svg">
                                            <circle cx="10" cy="10.5" r="10" fill="#43BC94"></circle>
                                            <path
                                                d="M9.85969 13.8389C10.1922 13.8374 10.5109 13.7054 10.747 13.4712L10.747 13.4713L10.7496 13.4685L18.7068 5.08439C18.825 4.96682 18.9188 4.8271 18.9829 4.67321C19.0473 4.51873 19.0804 4.35303 19.0804 4.18568C19.0804 4.01832 19.0473 3.85262 18.9829 3.69814C18.9186 3.5437 18.8243 3.40352 18.7055 3.28569C18.468 3.04958 18.1467 2.91704 17.8118 2.91704C17.4769 2.91704 17.1556 3.04958 16.918 3.28569L16.918 3.28564L16.9152 3.28862L9.85639 10.7804L8.06528 8.98932C7.95221 8.85834 7.81352 8.75187 7.65773 8.67649C7.50045 8.6004 7.32913 8.55764 7.15455 8.5509C6.97996 8.54416 6.80586 8.57357 6.64318 8.63731C6.4805 8.70104 6.33274 8.79771 6.2092 8.92126C6.08565 9.04481 5.98898 9.19256 5.92524 9.35524C5.86151 9.51792 5.83209 9.69202 5.83884 9.86661C5.84558 10.0412 5.88834 10.2125 5.96443 10.3698C6.03979 10.5255 6.14622 10.6642 6.27716 10.7773L8.95915 13.4707L8.9597 13.4712C9.07816 13.5887 9.21864 13.6817 9.3731 13.7447C9.52752 13.8078 9.69288 13.8398 9.85969 13.8389ZM9.85969 13.8389C9.85965 13.8389 9.85962 13.8389 9.85959 13.8389L9.85906 13.7139L9.85978 13.8389C9.85975 13.8389 9.85972 13.8389 9.85969 13.8389Z"
                                                fill="white" stroke="white" stroke-width="0.25"></path>
                                        </svg>
                                    </div>
                                </div>
                                <div class="col-4">
                                    <p class="m-0">{{ item.DisplayName }}</p>
                                </div>
                                <div class="col-3">
                                    <p class="m-0">{{ item.Code }}</p>
                                </div>
                                <div class="col-4">
                                    <p class="m-0">{{ item.Category }}</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    <app-pagination *ngIf="totalItemsCount > 0" [currentPage]="currentPage"
                        [totalCount]="totalItemsCount" (pageChange)="handlePageChange($event)"></app-pagination>
                </div>
                <div class="mt-3" *ngIf="showSelectedMultipleItems">
                    <div class="fixed_alter_list rounded border-primary-200">
                        <div class="fixed_alter_header bg-primary-100">
                            <div class="row gx-2 mx-0 p-2">
                                <div class="col-1"></div>
                                <div class="col-4">
                                    <p class="label m-0">Item Name</p>
                                </div>
                                <div class="col-3">
                                    <p class="label m-0">Item Code</p>
                                </div>
                                <div class="col-4">
                                    <p class="label m-0">Category Name</p>
                                </div>
                            </div>
                        </div>
                        <div class="fixed_alter_body">
                            <div class="row gx-2 mx-0 p-2 alter_div"
                                *ngFor="let item of selectedMultiItemsList;let i=index">
                                <div class="col-1">
                                    <div class="custom_check d-flex align-items-center justify-content-center"
                                        [class.active]="item.selected" (click)="selectMultiItem(item)">
                                        <svg width="17" height="17" viewBox="0 0 20 21" fill="none"
                                            xmlns="http://www.w3.org/2000/svg" class="check_svg">
                                            <circle cx="10" cy="10.5" r="10" fill="#43BC94"></circle>
                                            <path
                                                d="M9.85969 13.8389C10.1922 13.8374 10.5109 13.7054 10.747 13.4712L10.747 13.4713L10.7496 13.4685L18.7068 5.08439C18.825 4.96682 18.9188 4.8271 18.9829 4.67321C19.0473 4.51873 19.0804 4.35303 19.0804 4.18568C19.0804 4.01832 19.0473 3.85262 18.9829 3.69814C18.9186 3.5437 18.8243 3.40352 18.7055 3.28569C18.468 3.04958 18.1467 2.91704 17.8118 2.91704C17.4769 2.91704 17.1556 3.04958 16.918 3.28569L16.918 3.28564L16.9152 3.28862L9.85639 10.7804L8.06528 8.98932C7.95221 8.85834 7.81352 8.75187 7.65773 8.67649C7.50045 8.6004 7.32913 8.55764 7.15455 8.5509C6.97996 8.54416 6.80586 8.57357 6.64318 8.63731C6.4805 8.70104 6.33274 8.79771 6.2092 8.92126C6.08565 9.04481 5.98898 9.19256 5.92524 9.35524C5.86151 9.51792 5.83209 9.69202 5.83884 9.86661C5.84558 10.0412 5.88834 10.2125 5.96443 10.3698C6.03979 10.5255 6.14622 10.6642 6.27716 10.7773L8.95915 13.4707L8.9597 13.4712C9.07816 13.5887 9.21864 13.6817 9.3731 13.7447C9.52752 13.8078 9.69288 13.8398 9.85969 13.8389ZM9.85969 13.8389C9.85965 13.8389 9.85962 13.8389 9.85959 13.8389L9.85906 13.7139L9.85978 13.8389C9.85975 13.8389 9.85972 13.8389 9.85969 13.8389Z"
                                                fill="white" stroke="white" stroke-width="0.25"></path>
                                        </svg>
                                    </div>
                                </div>
                                <div class="col-4">
                                    <p class="m-0">{{ item.DisplayName }}</p>
                                </div>
                                <div class="col-3">
                                    <p class="m-0">{{ item.Code }}</p>
                                </div>
                                <div class="col-4">
                                    <p class="m-0">{{ item.Category }}</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="modal" id="errorMsg" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered modal-toast modal-toast-success">
        <div class="modal-content">
            <img class="modal-header-icon" src="assets/images/icons/toast-info.svg" alt="">
            <div class="modal-body">
                <p>{{errorMsg}}</p>
                <div class="modal-footer">
                    <a href="javascript:void(0)" type="button" class="btn btn-main-outline"
                        data-bs-dismiss="modal">{{langData?.common?.ok}}</a>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="modal" id="successMsg" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered modal-toast modal-toast-success">
        <div class="modal-content">
            <img class="modal-header-icon" src="assets/images/icons/toast-success.svg" alt="">
            <div class="modal-body">
                <p>{{successMsg}}</p>
                <div class="modal-footer">
                    <a href="javascript:void(0)" type="button" class="btn btn-main-outline"
                        data-bs-dismiss="modal">Ok</a>
                </div>
            </div>
        </div>
    </div>
</div>