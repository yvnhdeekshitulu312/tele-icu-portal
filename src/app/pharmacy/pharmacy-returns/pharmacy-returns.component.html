

<!--Container-->
<div class="container__wrapper p-0 position-relative" style="background-color: #fff;overflow-x: hidden;">
    <div class="page-header sticky-top bg-primary-50 shadow-sm justify-content-between">
        <form [formGroup]="pharmacyReturnsForm">
            <div class="d-flex align-items-center gap-2">
                <h2 class="page-heading d-flex align-items-center m-0 text-nowrap">
                    Pharmacy Returns
                </h2>
                <div class="" style="min-width: 18rem">
                    <div class="CommanSearch__form w-100 ps-2" style="height: 2rem">
                        <label for="" class="CommonSearch__label">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="22" viewBox="0 0 25 24" fill="none">
                                <g clip-path="url(#clip0_72_1908)">
                                    <path
                                        d="M11.0835 2.00003C16.0515 2.00003 20.0835 6.03203 20.0835 11C20.0835 15.968 16.0515 20 11.0835 20C6.1155 20 2.0835 15.968 2.0835 11C2.0835 6.03203 6.1155 2.00003 11.0835 2.00003ZM11.0835 18C14.9505 18 18.0835 14.867 18.0835 11C18.0835 7.13203 14.9505 4.00003 11.0835 4.00003C7.2155 4.00003 4.0835 7.13203 4.0835 11C4.0835 14.867 7.2155 18 11.0835 18ZM19.5685 18.071L22.3975 20.899L20.9825 22.314L18.1545 19.485L19.5685 18.071V18.071Z"
                                        fill="#368796" />
                                </g>
                            </svg>
                        </label>
                        <input class="CommonSearch__input form-control" formControlName="ssn" placeholder="Search for ID" placeholder="ID No"
                            (keypress)="($event.charCode >= 48 && $event.charCode < 58)" (keydown.enter)="onEnterPress($event)" />
                    </div>
                </div>
                <div class="dropdown custom_dropdown" style="min-width: 15rem">
                    <select name="" class="form-select" id="billNoDropdown" (change)="onBillNoChange($event)">
                        <option value="" selected>Bill No</option>
                        <option *ngFor="let billno of pharmacyBillNos" [value]="billno.OrderSlNo">
                            {{billno.OrderSlNo}}-{{billno.SalesDate}}
                         </option>
                    </select>
                </div>
                <div class="input-group">
                    <input type="text" formControlName="billNo" class="form-control" placeholder="Bill No" (keydown.enter)="onBillNoEnterPress($event)"/>
                    <button class="btn btn-secondary-fill btn-icon" type="button" id="billno">
                        <img src="assets/images/icons/icon-search.svg" alt="" />
                    </button>
                </div>
    
            </div>
        </form>
        
        <div class="d-flex align-items-center gap-2">
            <button class="btn btn-main-outline" (click)="viewPharmacyReturns()">View</button>
            <button class="btn btn-main-outline">Print</button>
            <button class="btn btn-danger-outline" (click)="clearScreen()">Clear</button>
            <button class="btn btn-main-outline" *ngIf="PatientCashIssuesTable1DataList && PatientCashIssuesTable1DataList[0]?.SalesType === 'CR'" (click)="getBillDetails()">Calculate</button>
            <button class="btn btn-main-outline" *ngIf="PatientCashIssuesTable1DataList && PatientCashIssuesTable1DataList[0]?.SalesType === 'CR' && showSave" (click)="onSaveClick('CR')">Save</button>
            <button class="btn btn-main-outline" *ngIf="PatientCashIssuesTable1DataList && PatientCashIssuesTable1DataList[0]?.SalesType === 'CI'" (click)="onSaveClick('CI')">Save</button>
        </div>
    </div>
    <div class="doctor_worklist overflow-hidden worklist_patientcard rounded-0 border-0">
        <div class="row mx-0">
            <div class="col-md-12 p-0">
                <div class="d-flex mx-0 gap-2 border-bottom p-1">
                    <div style="width: 20rem;">
                        <div class="d-flex align-items-center h-100">
                            <div class="patient-photo me-3"><img src="assets/images/icons/female.svg" alt=""
                                    class="position-relative"></div>
                            <div>
                                <p class="value clr-primary m-0 fs-7 fw-bold w-100"> {{patientDetails?.PatientName}} </p>
                                <div class="d-flex align-items-center gap-2 mt-1">
                                    <p class="m-0"> {{patientDetails?.Gender}} | {{patientDetails?.FullAge}} </p>
                                    <p class="m-0"> ID No: <span class="fw-bold">{{patientDetails?.SSN}}</span></p>
                                </div>
                                <p translate="" class="m-0 mt-1" ng-reflect-translate=""><span>{{patientDetails?.Nationality}}</span> | Mobile No:
                                    <span class="fw-bold">{{patientDetails?.MobileNo}}</span></p>
                            </div>
                        </div>
                    </div>
                    <div class="col pe-0">
                        <div class="bg-white h-100 p-1 rounded-2">
                            <div class="row mx-0">
                                <div class="col-3">
                                    <label for="" class="form-label m-0 fw-bold">Payer</label>
                                    <p class="text-wrap fs-8 m-0">{{patientDetails?.InsuranceCompanyName}}</p>
                                </div>
                                <div class="col-3">
                                    <label for="" class="form-label m-0 fw-bold">Company Name</label>
                                    <p class="text-wrap fs-8 m-0"> {{patientDetails?.CompanyName}}</p>
                                </div>
                                <div class="col-1">
                                    <label for="" class="form-label m-0 fw-bold">Grade</label>
                                    <p class="text-wrap fs-8 m-0"> {{patientDetails?.GradeName}}</p>
                                </div>
                                <div class="col">
                                    <label for="" class="form-label m-0 fw-bold">Bill Date</label>
                                    <p class="text-wrap fs-8 m-0"> {{selectedBillNo?.SalesDate}} </p>
                                </div>
                                <div class="col-2">
                                    <label for="" class="form-label m-0 fw-bold">Doctor</label>
                                    <p class="text-wrap fs-8 m-0"> {{selectedBillNo?.DoctorName}} </p>
                                </div>
                                <div class="col">
                                    <label for="" class="form-label m-0 fw-bold">User Name</label>
                                    <p class="text-wrap fs-8 m-0"> {{selectedBillNo?.OperatorName}} </p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="m-2 border rounded">
        <div class="row gx-2 mx-0">
            <div class="col border-end p-0">
                <div class="fixed_alter_list careplan_list">
                    <div class="fixed_alter_header bg-primary-50 rounded-top">
                        <div class="row gx-2 align-items-center p-1 py-2 mx-0">
                            <!-- <div class="" style="width: 3%;">
                                <p class="label clr-primary-600 m-0">Sl.no</p>
                            </div> -->
                            <div class="" style="width: 25%;">
                                <p class="label clr-primary-600 m-0">Item</p>
                            </div>
                            <div class="" style="width: 8%;">
                                <p class="label clr-primary-600 m-0">Batch No.</p>
                            </div>
                            <div class="" style="width: 8%;">
                                <p class="label clr-primary-600 m-0">Issue Qty</p>
                            </div>
                            <!-- <div class="" style="width: 8%;">
                                <p class="label clr-primary-600 m-0">Pre.Ret. Qty</p>
                            </div> -->
                            <div class="" style="width: 5%;">
                                <p class="label clr-primary-600 m-0">QUoM</p>
                            </div>
                            <div class="" style="width: 7%;">
                                <p class="label clr-primary-600 m-0">Tax</p>
                            </div>
                            <div class="" style="width: 7%;">
                                <p class="label clr-primary-600 m-0">UPrice</p>
                            </div>
                            <div class="" style="width: 7%;">
                                <p class="label clr-primary-600 m-0">Qty</p>
                            </div>
                            <div class="" style="width: 7%;">
                                <p class="label clr-primary-600 m-0">Units</p>
                            </div>
                            <div class="" style="width: 7%;">
                                <p class="label clr-primary-600 m-0">Amount</p>
                            </div>
                            <div class="" style="width: 5%;">
                                <p class="label clr-primary-600 m-0">Pat Pay</p>
                            </div>
                            <div class="" style="width: 3%;">
                                <p class="label clr-primary-600 m-0"></p>
                            </div>
                        </div>
                    </div>
                    <div class="fixed_alter_body height-unset">
                        <div class="row gx-2 align-items-center p-1 py-2 mx-0 alter_div" *ngFor="let item of selectedPharmacyItems;let i = index">
                            <!-- <div class="" style="width: 3%;">
                                <p class="m-0">1</p>
                            </div> -->
                            <div class="" style="width: 25%;">
                                <!-- <div class="input-group">
                                    <input type="text" class="form-control" placeholder="" aria-label="">
                                    <button class="btn btn-secondary-fill btn-icon" type="button" id="button-addon2">
                                        <img src="assets/images/icons/icon-search.svg" alt="">
                                    </button>
                                </div> -->
                                <p class="m-0">{{item.ItemName}}</p>
                            </div>
                            <div class="" style="width: 8%;">
                                <p class="m-0">{{item.BatchNO}}</p>
                            </div>
                            <div class="" style="width: 8%;">
                                <p class="m-0">{{item.Quantity}}</p>
                            </div>
                            <!-- <div class="" style="width: 8%;">
                                <p class="m-0">0</p>
                            </div> -->
                            <div class="" style="width: 5%;">
                                <p class="m-0">{{item.UOM}}</p>
                            </div>
                            <div class="" style="width: 7%;">
                                <p class="m-0">0</p>
                            </div>
                            <div class="" style="width: 7%;">
                                <p class="m-0">{{item.UPrice}}</p>
                            </div>
                            <div class="" style="width: 7%;">
                                <input type="text" [(ngModel)]="item.returnQuantity" (change)="calcItemPrice(item)" class="form-control">
                            </div>
                            <div class="" style="width: 7%;">
                                <p class="m-0">{{item.UOM}}</p>
                                <!-- <select name="" class="form-select pe-5" id="">
                                    <option value="">Box </option>
                                    <option *ngFor="let uom of filterItemUoms(item)" [value]="uom.UoMId">
                                        {{uom.FullUoM}}
                                        </option>
                                </select> -->
                            </div>
                            <div class="" style="width: 7%;">
                                <p class="m-0">{{item.calcUPrice || 0}}</p>
                            </div>
                            <div class="" style="width: 5%;">
                                <p class="m-0">0.00</p>
                            </div>
                            <div class="" style="width: 3%;">
                                <div class="d-flex align-items-center gap-3">
                                    <div class="del_svg cursor-pointer custom_tooltip" (click)="deleteSelectedItem(i, item)">
                                        <svg width="23" height="22" viewBox="0 0 23 22" fill="none"
                                            xmlns="http://www.w3.org/2000/svg">
                                            <path
                                                d="M20.0995 6.16917H20.0261C15.177 5.68334 10.337 5.5 5.5428 5.98584L3.6728 6.16917C3.58184 6.17866 3.48989 6.17003 3.40228 6.14377C3.31467 6.11751 3.23314 6.07414 3.16239 6.01618C3.09164 5.95822 3.03308 5.8868 2.9901 5.80607C2.94712 5.72534 2.92056 5.63689 2.91197 5.54584C2.8753 5.16084 3.1503 4.83084 3.52614 4.79417L5.39614 4.61084C10.2728 4.11584 15.2136 4.30834 20.1636 4.79417C20.5395 4.83084 20.8145 5.17 20.7778 5.54584C20.764 5.71605 20.6864 5.87477 20.5607 5.99032C20.4349 6.10586 20.2702 6.16973 20.0995 6.16917Z"
                                                fill="#EB6247"></path>
                                            <path
                                                d="M8.64147 5.24333C8.6048 5.24333 8.56813 5.24333 8.5223 5.23416C8.34445 5.20211 8.18627 5.10159 8.08172 4.95419C7.97717 4.80679 7.93459 4.62427 7.96313 4.44583L8.1648 3.24499C8.31147 2.36499 8.51313 1.14583 10.649 1.14583H13.0506C15.1956 1.14583 15.3973 2.41083 15.5348 3.25416L15.7365 4.44583C15.8006 4.82166 15.544 5.17916 15.1773 5.23416C14.8015 5.29833 14.444 5.04166 14.389 4.67499L14.1873 3.48333C14.059 2.68583 14.0315 2.52999 13.0598 2.52999H10.6581C9.68647 2.52999 9.66813 2.65833 9.53063 3.47416L9.3198 4.66583C9.29369 4.82694 9.2111 4.97351 9.08683 5.07931C8.96255 5.18512 8.80468 5.24325 8.64147 5.24333ZM14.7923 20.856H8.9073C5.70813 20.856 5.5798 19.0868 5.47897 17.6568L4.88313 8.42599C4.85563 8.05016 5.14897 7.72016 5.5248 7.69266C5.9098 7.67433 6.23063 7.95849 6.25813 8.33433L6.85397 17.5652C6.9548 18.9585 6.99147 19.481 8.9073 19.481H14.7923C16.7173 19.481 16.754 18.9585 16.8456 17.5652L17.4415 8.33433C17.469 7.95849 17.799 7.67433 18.1748 7.69266C18.5506 7.72016 18.844 8.041 18.8165 8.42599L18.2206 17.6568C18.1198 19.0868 17.9915 20.856 14.7923 20.856Z"
                                                fill="#EB6247"></path>
                                            <path
                                                d="M13.3714 15.8125H10.3189C9.94311 15.8125 9.63144 15.5008 9.63144 15.125C9.63144 14.7492 9.94311 14.4375 10.3189 14.4375H13.3714C13.7473 14.4375 14.0589 14.7492 14.0589 15.125C14.0589 15.5008 13.7473 15.8125 13.3714 15.8125ZM14.1414 12.1458H9.55811C9.18227 12.1458 8.87061 11.8342 8.87061 11.4583C8.87061 11.0825 9.18227 10.7708 9.55811 10.7708H14.1414C14.5173 10.7708 14.8289 11.0825 14.8289 11.4583C14.8289 11.8342 14.5173 12.1458 14.1414 12.1458Z"
                                                fill="#EB6247"></path>
                                        </svg>
                                        <div class="tooltip">
                                            <p>Delete</p>
                                        </div>
                                    </div>
                                    <!-- <div class="edit_svg cursor-pointer custom_tooltip">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="23" height="23" viewBox="0 0 18 17"
                                            fill="none">
                                            <path
                                                d="M3.16669 13.5024H6.70002C6.80969 13.503 6.91841 13.482 7.01994 13.4406C7.12147 13.3991 7.21382 13.338 7.29169 13.2607L13.0584 7.48574L15.425 5.16908C15.5031 5.09161 15.5651 4.99944 15.6074 4.89789C15.6497 4.79634 15.6715 4.68742 15.6715 4.57741C15.6715 4.4674 15.6497 4.35848 15.6074 4.25693C15.5651 4.15538 15.5031 4.06321 15.425 3.98574L11.8917 0.410744C11.8142 0.332637 11.7221 0.270642 11.6205 0.228335C11.519 0.186027 11.41 0.164246 11.3 0.164246C11.19 0.164246 11.0811 0.186027 10.9795 0.228335C10.878 0.270642 10.7858 0.332637 10.7084 0.410744L8.35835 2.76908L2.57502 8.54408C2.49779 8.62195 2.43668 8.71429 2.39521 8.81582C2.35374 8.91735 2.33272 9.02607 2.33335 9.13575V12.6691C2.33335 12.8901 2.42115 13.1021 2.57743 13.2583C2.73371 13.4146 2.94567 13.5024 3.16669 13.5024ZM11.3 2.17741L13.6584 4.53574L12.475 5.71908L10.1167 3.36074L11.3 2.17741ZM4.00002 9.47741L8.94169 4.53574L11.3 6.89408L6.35835 11.8357H4.00002V9.47741ZM16.5 15.1691H1.50002C1.27901 15.1691 1.06705 15.2569 0.910765 15.4132C0.754484 15.5694 0.666687 15.7814 0.666687 16.0024C0.666687 16.2234 0.754484 16.4354 0.910765 16.5917C1.06705 16.7479 1.27901 16.8357 1.50002 16.8357H16.5C16.721 16.8357 16.933 16.7479 17.0893 16.5917C17.2456 16.4354 17.3334 16.2234 17.3334 16.0024C17.3334 15.7814 17.2456 15.5694 17.0893 15.4132C16.933 15.2569 16.721 15.1691 16.5 15.1691Z"
                                                fill="#FFAD0E" />
                                        </svg>
                                        <div class="tooltip">
                                            <p>Edit</p>
                                        </div>
                                    </div> -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-3 p-0" style="width: 20rem;">
                <div class="row gx-2 border-bottom align-items-center mx-0">
                    <div class="col-6 text-end border-end">
                        <p class="p-2 m-0 eligible_label fs-8">Discount on Bill (%)</p>
                    </div>
                    <div class="col-6">
                        <p class="p-2 m-0 fs-6 text-nowrap">0</p>
                    </div>
                </div>
                <div class="row gx-2 border-bottom align-items-center mx-0">
                    <div class="col-6 text-end border-end">
                        <p class="p-2 m-0 eligible_label fs-8">Discount on Return</p>
                    </div>
                    <div class="col-6">
                        <p class="p-2 m-0 fs-6 text-nowrap">00.00</p>
                    </div>
                </div>
                <div class="row gx-2 border-bottom align-items-center mx-0">
                    <div class="col-6 text-end border-end">
                        <p class="p-2 m-0 eligible_label fs-8">Return Amount</p>
                    </div>
                    <div class="col-6">
                        <p class="p-2 m-0 fs-6 text-nowrap">{{ PatientCashIssuesTable1DataList && PatientCashIssuesTable1DataList[0]?.SalesType === 'CR' ? creditreturnAmount : calculateReturnAmount() }}</p>
                    </div>
                </div>
                <!-- <div class="row gx-2 border-bottom align-items-center mx-0">
                    <div class="col-6 text-end border-end">
                        <p class="p-2 m-0 eligible_label fs-8">Net Return Amount</p>
                    </div>
                    <div class="col-6">
                        <p class="p-2 m-0 fs-6 text-nowrap">00.00</p>
                    </div>
                </div> -->
                <div class="row gx-2 border-bottom align-items-center mx-0">
                    <div class="col-6 text-end border-end">
                        <p class="p-2 m-0 eligible_label fs-8">Mode of Payment</p>
                    </div>
                    <div class="col-6 p-2">
                        <select name="" class="form-select pe-5" id="" disabled>
                            <option value="">Cash</option>
                        </select>
                    </div>
                </div>
                <div class="row gx-2 border-bottom align-items-center mx-0">
                    <div class="col-6 text-end border-end">
                        <p class="p-2 m-0 eligible_label fs-8">Receipt Amount</p>
                    </div>
                    <div class="col-6 p-2">
                        <input type="text" class="form-control">
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>



<div class="modal" id="savemsg" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered modal-toast modal-toast-success">
        <div class="modal-content">
            <img class="modal-header-icon" src="assets/images/icons/toast-success.svg" alt="">
            <div class="modal-body">
                <p>Returns successfully</p>
                <div class="modal-footer">
                    <a href="javascript:void(0)" type="button" class="btn btn-main-outline"
                        data-bs-dismiss="modal">Ok</a>
                </div>
            </div>
        </div>
    </div>
</div>


<div class="substitute_Modal modal" data-bs-backdrop="static" tabindex="-1" id="divMultiplePatients" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered" style="max-width: 60%;">
       <div class="modal-content">
          <div class="modal-header">
             <h5 class="modal-title" id="exampleModalLabel">Patients Information</h5>
 
             <div class="d-flex align-items-center gap-2 ms-auto">
                <button class="btn btn-main-outline"
                   (click)="fetchSelectedPatientPharmacyIssues()">Select</button>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
             </div>
          </div>
          <div class="modal-body" style="height: calc(100vh - 18rem); overflow: auto;">
             <div>
                <p *ngIf="showSubstituteValidation" class="text-danger">Please select any Item to continue</p>
             </div>
             <div class="" *ngFor="let pat of multiplePatients; let i = index">
                <div class="border rounded-2 mt-2 p-2">
                   <div class="row mx-0 g-2 w-100">
                      <div class="col-md-5">
                         <div class="d-flex align-items-center gap-2">
                            <div class="custom_check d-flex align-items-center" [class.active]="pat.selected"
                               (click)="selectPatient(pat)">
                               <svg width="18" height="18" viewBox="0 0 20 21" fill="none"
                                  xmlns="http://www.w3.org/2000/svg" class="check_svg">
                                  <circle cx="10" cy="10.5" r="10" fill="#43BC94"></circle>
                                  <path
                                     d="M9.85969 13.8389C10.1922 13.8374 10.5109 13.7054 10.747 13.4712L10.747 13.4713L10.7496 13.4685L18.7068 5.08439C18.825 4.96682 18.9188 4.8271 18.9829 4.67321C19.0473 4.51873 19.0804 4.35303 19.0804 4.18568C19.0804 4.01832 19.0473 3.85262 18.9829 3.69814C18.9186 3.5437 18.8243 3.40352 18.7055 3.28569C18.468 3.04958 18.1467 2.91704 17.8118 2.91704C17.4769 2.91704 17.1556 3.04958 16.918 3.28569L16.918 3.28564L16.9152 3.28862L9.85639 10.7804L8.06528 8.98932C7.95221 8.85834 7.81352 8.75187 7.65773 8.67649C7.50045 8.6004 7.32913 8.55764 7.15455 8.5509C6.97996 8.54416 6.80586 8.57357 6.64318 8.63731C6.4805 8.70104 6.33274 8.79771 6.2092 8.92126C6.08565 9.04481 5.98898 9.19256 5.92524 9.35524C5.86151 9.51792 5.83209 9.69202 5.83884 9.86661C5.84558 10.0412 5.88834 10.2125 5.96443 10.3698C6.03979 10.5255 6.14622 10.6642 6.27716 10.7773L8.95915 13.4707L8.9597 13.4712C9.07816 13.5887 9.21864 13.6817 9.3731 13.7447C9.52752 13.8078 9.69288 13.8398 9.85969 13.8389ZM9.85969 13.8389C9.85965 13.8389 9.85962 13.8389 9.85959 13.8389L9.85906 13.7139L9.85978 13.8389C9.85975 13.8389 9.85972 13.8389 9.85969 13.8389Z"
                                     fill="white" stroke="white" stroke-width="0.25"></path>
                               </svg>
                            </div>
                            <div>
                               <p class="clr-primary-600 text-nowrap">Name</p>
                               <p class="text-break">{{pat.PatientName}}</p>
                            </div>
                         </div>
                      </div>
                      <div class="d-flex align-items-start justify-content-between gap-1 col-6">
                         <div class="col-3">
                            <p class="clr-primary-600 text-nowrap">SSN</p>
                            <p class="text-break">{{pat.SSN}}</p>
                         </div>
                         <div class="col-4">
                            <p class="clr-primary-600 text-nowrap">Age | Gender</p>
                            <p class="text-break">{{pat.FullAge}} | {{pat.Gender}}</p>
                         </div>
                         <div class="col-3">
                            <p class="clr-primary-600 text-nowrap">MobileNo</p>
                            <p class="text-break">{{pat.MobileNo}}</p>
                         </div>
                         <div class="col-3">
                            <p class="clr-primary-600 text-nowrap">Nationality</p>
                            <p class="text-break">{{pat.Nationality}}</p>
                         </div>
 
                      </div>
                   </div>
                </div>
             </div>
          </div>
       </div>
    </div>
 </div>

 <div class="substitute_Modal modal" data-bs-backdrop="static" tabindex="-1" id="divPharmacyIssues" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered" style="max-width: 80%;">
       <div class="modal-content">
          <div class="modal-header border-bottom-primary-200">
             <h5 class="modal-title" id="exampleModalLabel">Medicines Issued</h5>
 
             <div class="d-flex align-items-center gap-2 ms-auto">
                <button class="btn btn-main-outline"
                   (click)="fetchSelectedPatientPharmacyIssues()">Select</button>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
             </div>
          </div>
          <div class="modal-body p-0">
             <div>
                <p *ngIf="showSubstituteValidation" class="text-danger">Please select any Patient to continue</p>
             </div>
             <div class="fixed_alter_list">
                <div class="fixed_alter_header bg-primary-50 rounded-top">
                    <div class="row gx-2 align-items-center p-1 py-2 mx-0">
                        <div class="" style="width: 3%;">
                            <p class="label clr-primary-600 m-0"></p>
                        </div>
                        <div class="" style="width: 25%;">
                            <p class="label clr-primary-600 m-0">Item</p>
                        </div>
                        <div class="" style="width: 8%;">
                            <p class="label clr-primary-600 m-0">Batch No.</p>
                        </div>
                        <div class="" style="width: 8%;">
                            <p class="label clr-primary-600 m-0">Issue Qty</p>
                        </div>
                        <div class="" style="width: 8%;">
                            <p class="label clr-primary-600 m-0">Pre.Ret. Qty</p>
                        </div>
                        <div class="" style="width: 5%;">
                            <p class="label clr-primary-600 m-0">QUoM</p>
                        </div>
                        <div class="" style="width: 7%;">
                            <p class="label clr-primary-600 m-0">Tax</p>
                        </div>
                        <div class="" style="width: 7%;">
                            <p class="label clr-primary-600 m-0">UPrice</p>
                        </div>
                        <div class="" style="width: 7%;">
                            <p class="label clr-primary-600 m-0">Returned Qty</p>
                        </div>
                        <div class="" style="width: 7%;">
                            <p class="label clr-primary-600 m-0">Units</p>
                        </div>
                        <div class="" style="width: 7%;">
                            <p class="label clr-primary-600 m-0">Amount</p>
                        </div>
                        <div class="" style="width: 5%;">
                            <p class="label clr-primary-600 m-0">Pat Pay</p>
                        </div>
                        <div class="" style="width: 3%;">
                            <p class="label clr-primary-600 m-0"></p>
                        </div>
                    </div>
                </div>
                <div class="fixed_alter_body">
                    <div class="row gx-2 align-items-center p-1 py-2 mx-0 alter_div" *ngFor="let item of selectedBillDetails;">
                        <div class="custom_check d-flex align-items-center" style="width: 3%;" [class.active]="item.selected"
                            (click)="selectPharmacyItem(item)">
                            <svg width="18" height="18" viewBox="0 0 20 21" fill="none"
                                xmlns="http://www.w3.org/2000/svg" class="check_svg">
                                <circle cx="10" cy="10.5" r="10" fill="#43BC94"></circle>
                                <path
                                d="M9.85969 13.8389C10.1922 13.8374 10.5109 13.7054 10.747 13.4712L10.747 13.4713L10.7496 13.4685L18.7068 5.08439C18.825 4.96682 18.9188 4.8271 18.9829 4.67321C19.0473 4.51873 19.0804 4.35303 19.0804 4.18568C19.0804 4.01832 19.0473 3.85262 18.9829 3.69814C18.9186 3.5437 18.8243 3.40352 18.7055 3.28569C18.468 3.04958 18.1467 2.91704 17.8118 2.91704C17.4769 2.91704 17.1556 3.04958 16.918 3.28569L16.918 3.28564L16.9152 3.28862L9.85639 10.7804L8.06528 8.98932C7.95221 8.85834 7.81352 8.75187 7.65773 8.67649C7.50045 8.6004 7.32913 8.55764 7.15455 8.5509C6.97996 8.54416 6.80586 8.57357 6.64318 8.63731C6.4805 8.70104 6.33274 8.79771 6.2092 8.92126C6.08565 9.04481 5.98898 9.19256 5.92524 9.35524C5.86151 9.51792 5.83209 9.69202 5.83884 9.86661C5.84558 10.0412 5.88834 10.2125 5.96443 10.3698C6.03979 10.5255 6.14622 10.6642 6.27716 10.7773L8.95915 13.4707L8.9597 13.4712C9.07816 13.5887 9.21864 13.6817 9.3731 13.7447C9.52752 13.8078 9.69288 13.8398 9.85969 13.8389ZM9.85969 13.8389C9.85965 13.8389 9.85962 13.8389 9.85959 13.8389L9.85906 13.7139L9.85978 13.8389C9.85975 13.8389 9.85972 13.8389 9.85969 13.8389Z"
                                fill="white" stroke="white" stroke-width="0.25"></path>
                            </svg>
                        </div>
                        <div class="" style="width: 25%;">
                            <!-- <div class="input-group">
                                <input type="text" class="form-control" placeholder="" aria-label="">
                                <button class="btn btn-secondary-fill btn-icon" type="button" id="button-addon2">
                                    <img src="assets/images/icons/icon-search.svg" alt="">
                                </button>
                            </div> -->
                            <p class="m-0">{{item.ItemName}}</p>
                        </div>
                        <div class="" style="width: 8%;">
                            <p class="m-0">{{item.BatchNO}}</p>
                        </div>
                        <div class="" style="width: 8%;">
                            <p class="m-0">{{item.Quantity}}</p>
                        </div>
                        <div class="" style="width: 8%;">
                            <p class="m-0">0</p>
                        </div>
                        <div class="" style="width: 5%;">
                            <p class="m-0">{{item.UOM}}</p>
                        </div>
                        <div class="" style="width: 7%;">
                            <p class="m-0">0</p>
                        </div>
                        <div class="" style="width: 7%;">
                            <p class="m-0">{{item.UPrice}}</p>
                        </div>
                        <div class="" style="width: 7%;">
                            <p class="m-0">{{item.RetQty}}</p>
                        </div>
                        <div class="" style="width: 7%;">
                            <p class="m-0">{{item.UOM}}</p>
                            <!-- <select name="" class="form-select pe-5" id="">
                                <option value="">Box </option>
                                <option *ngFor="let uom of filterItemUoms(item)" [value]="uom.UoMId">
                                    {{uom.FullUoM}}
                                    </option>
                            </select> -->
                        </div>
                        <div class="" style="width: 7%;">
                            <p class="m-0">{{item.Total}}</p>
                        </div>
                        <div class="" style="width: 5%;">
                            <p class="m-0">{{item.CollectedAmount}}</p>
                        </div>
                    </div>
                </div>
            </div>

          </div>
       </div>
    </div>
 </div>

 <div class="modal" id="errorMsg" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered modal-toast modal-toast-success">
        <div class="modal-content">
            <img class="modal-header-icon" src="assets/images/icons/toast-info.svg" alt="">
            <div class="modal-body">
                <p>{{errorMsg}}</p>
                <div class="modal-footer">
                    <a href="javascript:void(0)" type="button" class="btn btn-main-outline"
                        data-bs-dismiss="modal">{{langData?.common?.ok}}</a>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="divViewBillInfo_Modal modal" data-bs-backdrop="static" tabindex="-1" id="divViewBillInfo" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered" style="max-width: 98%;">
       <div class="modal-content">
          <div class="modal-header">
             <h5 class="modal-title" id="exampleModalLabel">View Pharmacy Returns</h5>
 
             <div class="d-flex align-items-center gap-2 ms-auto">
                <form action="" class="CommanSearch__form" style="width: 14rem;">
                   <input class="CommonSearch__input form-control px-0" type="text" id="viewBillSSN" placeholder="SSN"  (input)="onViewBillsSSNSearch($event)">
               </form>
                <button class="date_range_calendar p-0 position-relative" style="width: 227px !important;">
                   <mat-date-range-input class="btn btn-main-outline" [formGroup]="viewBillInfoForm"
                      [rangePicker]="picker1">
                      <input matStartDate formControlName="FromDate">
                      <input matEndDate formControlName="ToDate" (dateChange)="viewPharmacyReturns()">
                   </mat-date-range-input>
                   <mat-datepicker-toggle matIconSuffix [for]="picker1"></mat-datepicker-toggle>
                   <mat-date-range-picker #picker1></mat-date-range-picker>
                </button>
                <button class="btn btn-main-outline" (click)="viewPharmacyReturns()">Search</button>
                <button class="btn btn-danger-outline" (click)="clearBillInfo()">Clear</button>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
             </div>
          </div>
          <div class="modal-body p-2">
             <div>
                <p *ngIf="showSubstituteValidation" class="text-danger">Please select any Prescription to continue</p>
             </div>
             <div class="">
 
                <div class="fixed_alter_list mt-2 viewPharmacyBills_table border-primary-200 rounded">
                   <div class="fixed_alter_header bg-primary-50 rounded-top">
                      <div class="row gx-2 py-2 py-1 mx-0">
                         <div class="col-11">
                            <div class="row gx-2 mx-0">
                               <div class="col-2">
                                  <label for="" class="form-label fw-bold clr-primary-600 m-0">Bill No.</label>
                               </div>
                               <div class="col-3">
                                  <label for="" class="form-label fw-bold clr-primary-600 m-0">Patient Name</label>
                               </div>
                               <div class="col-2">
                                  <label for="" class="form-label fw-bold clr-primary-600 m-0">Bill Date</label>
                               </div>
                               <div class="col-1">
                                  <label for="" class="form-label fw-bold clr-primary-600 m-0">User</label>
                               </div>
                               <div class="col-1">
                                  <label for="" class="form-label fw-bold clr-primary-600 m-0">Bill Type</label>
                               </div>
                            </div>
                         </div>
                         <div class="col"></div>
                      </div>
                   </div>
                   <div class="fixed_alter_body">
                      <div class="row gx-2 py-2 mx-0 alter_div" *ngFor="let pres of pharmacyReturnWorklist; let i = index">
                         <div class="col-11 cursor-pointer" (click)="selectReturn(pres)">
                            <div class="row gx-2 mx-0">
                               <div class="col-2">
                                  <p class="m-0">{{pres.Billno}}</p>
                               </div>
                               <div class="col-3">
                                  <p class="m-0">{{pres.SSN}} | {{pres.FullName}}</p>
                               </div>
                               <div class="col-2">
                                  <p>
                                     <svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 16 16"
                                        fill="none">
                                        <path fill-rule="evenodd" clip-rule="evenodd"
                                           d="M13.8552 1.56632H13.131V1.39789C13.131 0.623158 12.5079 0 11.7331 0C10.9584 0 10.3352 0.623158 10.3352 1.39789V1.56632H9.24049V1.39789C9.24049 0.623158 8.61733 0 7.84259 0C7.06785 0 6.4447 0.623158 6.4447 1.39789V1.56632H5.34996V1.39789C5.34996 0.623158 4.7268 0 3.95206 0C3.17733 0 2.55417 0.623158 2.55417 1.39789V1.56632H1.82996C0.886801 1.56632 0.128906 2.32421 0.128906 3.26737V14.2989C0.128906 15.2421 0.886801 16 1.82996 16H13.8215C14.7647 16 15.5226 15.2421 15.5226 14.2989V3.28421C15.5563 2.34105 14.7984 1.56632 13.8552 1.56632ZM11.2279 1.41474C11.2279 1.12842 11.4636 0.909474 11.7331 0.909474C12.0194 0.909474 12.2384 1.14526 12.2384 1.41474V2.62737C12.2384 2.91368 12.0026 3.13263 11.7331 3.13263C11.4468 3.13263 11.2279 2.89684 11.2279 2.62737V1.41474ZM7.35417 1.41474C7.35417 1.12842 7.58996 0.909474 7.85943 0.909474C8.14575 0.909474 8.3647 1.14526 8.3647 1.41474V2.62737C8.3647 2.91368 8.12891 3.13263 7.85943 3.13263C7.57312 3.13263 7.35417 2.89684 7.35417 2.62737V1.41474ZM3.46364 1.41474C3.46364 1.12842 3.69943 0.909474 3.96891 0.909474C4.25522 0.909474 4.47417 1.14526 4.47417 1.41474V2.62737C4.47417 2.91368 4.23838 3.13263 3.96891 3.13263C3.68259 3.13263 3.46364 2.89684 3.46364 2.62737V1.41474ZM14.6805 14.3158C14.6805 14.7705 14.31 15.1411 13.8552 15.1411H1.86364C1.40891 15.1411 1.03838 14.7705 1.03838 14.3158V5.38947H14.6636V14.3158H14.6805ZM10.9753 13.3221C11.0932 13.44 11.2279 13.4905 11.3795 13.4905C11.5311 13.4905 11.6658 13.44 11.7837 13.3221L13.3332 11.7726C13.5521 11.5537 13.5521 11.1832 13.3332 10.9642C13.1142 10.7453 12.7437 10.7453 12.5248 10.9642L11.3795 12.1095L10.9584 11.6884C10.7395 11.4695 10.369 11.4695 10.15 11.6884C9.93107 11.9074 9.93107 12.2779 10.15 12.4968L10.9753 13.3221ZM4.92888 9.7179H3.19414C2.95835 9.7179 2.75625 9.51579 2.75625 9.28V7.52842C2.75625 7.29263 2.95835 7.09053 3.19414 7.09053H4.92888C5.16467 7.09053 5.36678 7.29263 5.36678 7.52842V9.28C5.36678 9.51579 5.16467 9.7179 4.92888 9.7179ZM7.0006 9.7179H8.73533C8.97112 9.7179 9.17323 9.51579 9.17323 9.28V7.52842C9.17323 7.29263 8.97112 7.09053 8.73533 7.09053H7.0006C6.76481 7.09053 6.5627 7.29263 6.5627 7.52842V9.28C6.54586 9.51579 6.74796 9.7179 7.0006 9.7179ZM12.5247 9.7179H10.79C10.5542 9.7179 10.3521 9.51579 10.3521 9.28V7.52842C10.3521 7.29263 10.5542 7.09053 10.79 7.09053H12.5247C12.7605 7.09053 12.9626 7.29263 12.9626 7.52842V9.28C12.9626 9.51579 12.7605 9.7179 12.5247 9.7179ZM3.19414 13.4569H4.92888C5.16467 13.4569 5.36678 13.2548 5.36678 13.019V11.2674C5.36678 11.0316 5.16467 10.8295 4.92888 10.8295H3.19414C2.95835 10.8295 2.75625 11.0316 2.75625 11.2674V13.019C2.75625 13.2548 2.95835 13.4569 3.19414 13.4569ZM8.73533 13.4569H7.0006C6.74796 13.4569 6.54586 13.2548 6.5627 13.019V11.2674C6.5627 11.0316 6.76481 10.8295 7.0006 10.8295H8.73533C8.97112 10.8295 9.17323 11.0316 9.17323 11.2674V13.019C9.17323 13.2548 8.97112 13.4569 8.73533 13.4569Z"
                                           fill="#7C8283" />
                                     </svg>
                                     {{pres.ReturnDate | date: 'dd-MMM-yyyy' }}
    
                                  </p>
                               </div>
                               <div class="col-1">
                                  <p class="m-0">{{pres.OperatorName}}</p>
                               </div>
                               <div class="col-1">
                                  <p class="m-0">{{ pres.ReturnType == 'CR' ? 'Insured' : 'Self' }}</p>
                               </div>
                            </div>
                         </div>
                         <div class="col text-end">
                            <svg (click)="pharmacyReturnPrint(pres)" class="cursor-pointer" width="28" height="28" viewBox="0 0 28 28" fill="none"
                               xmlns="http://www.w3.org/2000/svg">
                               <path
                                  d="M14.1348 27.389C21.6325 27.389 27.7106 21.3109 27.7106 13.8132C27.7106 6.31556 21.6325 0.237488 14.1348 0.237488C6.63716 0.237488 0.559082 6.31556 0.559082 13.8132C0.559082 21.3109 6.63716 27.389 14.1348 27.389Z"
                                  fill="#DAEEF1" />
                               <path
                                  d="M18.479 11.4964H18.1894V7.7313C18.1894 7.6545 18.1589 7.5808 18.1046 7.5265C18.0502 7.4722 17.9766 7.44165 17.8998 7.44165H10.3697C10.2098 7.44165 10.0802 7.5714 10.0802 7.7313V11.4964H9.79051C9.25282 11.4964 8.73723 11.7099 8.35702 12.0901C7.97682 12.4703 7.76318 12.986 7.76318 13.5236V17.2886C7.76318 17.3654 7.79373 17.4391 7.84803 17.4934C7.90233 17.5477 7.97603 17.5783 8.05283 17.5783H10.0802V19.8952C10.0802 19.972 10.1106 20.0457 10.1649 20.1C10.2193 20.1543 10.2929 20.1848 10.3697 20.1848H17.8998C17.9766 20.1848 18.0502 20.1543 18.1046 20.1C18.1589 20.0457 18.1894 19.972 18.1894 19.8952V17.5783H20.2167C20.2935 17.5783 20.3672 17.5477 20.4215 17.4934C20.4758 17.4391 20.5063 17.3654 20.5063 17.2886V13.5236C20.5063 12.986 20.2927 12.4703 19.9125 12.0901C19.5323 11.7099 19.0167 11.4964 18.479 11.4964ZM10.6595 8.02099H17.6102V11.4964H10.6595V8.02099ZM17.6102 19.6054H10.6595V15.2612H17.6102V19.6054ZM18.479 13.5235C18.3619 13.5235 18.2563 13.453 18.2115 13.3448C18.1666 13.2366 18.1914 13.112 18.2742 13.0291C18.357 12.9463 18.4816 12.9215 18.5899 12.9663C18.6981 13.0112 18.7687 13.1168 18.7687 13.2339C18.7687 13.3107 18.7381 13.3843 18.6838 13.4387C18.6295 13.493 18.5558 13.5235 18.479 13.5235Z"
                                  fill="#368796" stroke="#368796" stroke-width="0.15929" />
                            </svg>
                         </div>
 
                         <div class="mt-2" [class.d-none]="!pres.selected">
                            <div class="fixed_alter_list">
                               <div class="fixed_alter_header bg-primary-50">
                                  <div class="row gx-2 p-2 py-1 mx-0">
                                     <div class="" style="width: 3%;">
                                        <label for="" class="form-label fw-bold clr-primary-600 m-0">Sl.No.</label>
                                     </div>
                                     <div class="" style="width: 30%;">
                                        <label for="" class="form-label fw-bold clr-primary-600 m-0">Item Name</label>
                                     </div>
                                     <div class="" style="width: 7%;">
                                        <label for="" class="form-label fw-bold clr-primary-600 m-0">Qty/Units</label>
                                     </div>
                                     <div class="" style="width: 8%;">
                                        <label for="" class="form-label fw-bold clr-primary-600 m-0">Batch No</label>
                                     </div>
                                     <div class="" style="width: 8%;">
                                        <label for="" class="form-label fw-bold clr-primary-600 m-0">Expiry Date</label>
                                     </div>
                                     <div class="" style="width: 10%;">
                                        <label for="" class="form-label fw-bold clr-primary-600 m-0">UPrice</label>
                                     </div>
                                     <div class="" style="width: 10%;">
                                        <label for="" class="form-label fw-bold clr-primary-600 m-0">Tax</label>
                                     </div>
                                  </div>
                               </div>
                               <div class="fixed_alter_body height-unset">
                                  <div class="row gx-2 p-2 mx-0 alter_div"
                                     *ngFor="let item of pharmacyReturnWorklistItemDetails; let i = index">
                                     <div class="" style="width: 3%;">
                                        <p>{{i + 1}}</p>
                                     </div>
                                     <div class="" style="width: 30%;">
                                        <p><b>{{item.ItemCode}}-{{item.ItemName}}</b></p>
                                     </div>
                                     <div class="" style="width: 7%;">
                                        <p>{{item.Quantity}}-{{item.UOM}}</p>
                                     </div>
                                     <!--<div class="" style="width: 10%;">
                                        <p>BOX=20TABLET</p>
                                     </div>   
                                      <div class="" style="width: 10%;">
                                        <p></p>
                                     </div>  -->
                                     <div class="" style="width: 8%;">
                                        <p>{{item.BatchNO}}</p>
                                     </div>
                                     <div class="" style="width: 8%;">
                                        <p>{{item.Expirydate | date: 'dd-MMM-yyyy'}}</p>
                                     </div>
                                     <div class="" style="width: 10%;">
                                        <p>{{item.UPrice}}</p>
                                     </div>
                                     <div class="" style="width: 10%;">
                                        <p>{{item.Tax}}</p>
                                     </div>
       
                                  </div>
                               </div>
                            </div>
                         </div>
 
                      </div>
                   </div>
                </div>
 
 
             </div>
          </div>
       </div>
    </div>
 </div>

 <div class="modal" id="opPharmacyBillPrint">
    <div class="modal-dialog  modal-xl">
       <div class="modal-content">
          <div class="modal-header">
             <h5 class="modal-title">{{langData?.common?.radReport}}</h5>
             <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close" (click)="trustedUrl = ''"></button>
          </div>
          <div class="modal-body">
             <iframe *ngIf="trustedUrl" height="600" width="100%" [src]="(trustedUrl ? trustedUrl :'')| safeUrl" frameborder="0"></iframe>
          </div>
       </div>
    </div>
 </div>