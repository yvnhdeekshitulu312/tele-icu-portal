<div class="">
  <div class="page-header sticky-top justify-content-between shadow-sm">
    <div class="d-flex align-items-center gap-3">
      <h2 class="page-heading text-nowrap">Not Billed Orders</h2>
      <form
        [formGroup]="referralForm"
        (keydown.enter)="$event.preventDefault()"
      >
        <div class="d-flex align-items-center gap-2">
          <button
            class="date_range_calendar position-relative pd p-0"
            dir="ltr"
            style="height: 32px; width: 14rem !important"
          >
            <mat-date-range-input
              class="btn btn-main-outline"
              [rangePicker]="picker"
            >
              <input matStartDate formControlName="fromDate" />
              <input matEndDate formControlName="toDate" />
            </mat-date-range-input>
            <mat-datepicker-toggle
              matIconSuffix
              [for]="picker"
            ></mat-datepicker-toggle>
            <mat-date-range-picker #picker></mat-date-range-picker>
          </button>
          <div class="CommanSearch__form w-75 ps-2" style="height: 2rem">
            <label for="" class="CommonSearch__label">
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="20"
                height="22"
                viewBox="0 0 25 24"
                fill="none"
              >
                <g clip-path="url(#clip0_72_1908)">
                  <path
                    d="M11.0835 2.00003C16.0515 2.00003 20.0835 6.03203 20.0835 11C20.0835 15.968 16.0515 20 11.0835 20C6.1155 20 2.0835 15.968 2.0835 11C2.0835 6.03203 6.1155 2.00003 11.0835 2.00003ZM11.0835 18C14.9505 18 18.0835 14.867 18.0835 11C18.0835 7.13203 14.9505 4.00003 11.0835 4.00003C7.2155 4.00003 4.0835 7.13203 4.0835 11C4.0835 14.867 7.2155 18 11.0835 18ZM19.5685 18.071L22.3975 20.899L20.9825 22.314L18.1545 19.485L19.5685 18.071V18.071Z"
                    fill="#368796"
                  />
                </g>
              </svg>
            </label>
            <input
              class="CommonSearch__input form-control"
              placeholder="Search for ID"
              placeholder="ID No"
              formControlName="ssn"
            />
          </div>
        </div>
      </form>
    </div>
    <div class="d-flex align-items-center gap-2 ms-3">
      <button class="btn btn-main-outline" (click)="searchBillOrders()">
        Search
      </button>
      <button class="btn btn-danger-outline" (click)="clearList()">
        Clear
      </button>
    </div>
  </div>

  <div class="p-2">
    <div class="d-flex align-items-center justify-content-between">
      <ul
        id="nav-tab"
        role="tablist"
        class="nav nav-pills rounded-top"
        #navTabs
      >
        <!-- <li class="nav-item">
          <button
            data-bs-toggle="pill"
            data-bs-target="#ServiceOrders"
            type="button"
            role="tab"
            aria-controls="ServiceOrders"
            aria-selected="false"
            class="nav-link px-3"
            translate
            (click)="setActiveTab('ServiceOrders')"
          >
            Service Orders
          </button>
        </li> -->
        <li class="nav-item">
          <button
            data-bs-toggle="pill"
            data-bs-target="#PharmacyOrders"
            type="button"
            role="tab"
            aria-controls="PharmacyOrders"
            aria-selected="false"
            class="nav-link active px-3"
            translate
            (click)="setActiveTab('PharmacyOrders')"
          >
            Pharmacy Orders
          </button>
        </li>
      </ul>
      <div class="d-flex align-items-center gap-2 notbilled_legends">
        <div
          class="d-flex align-items-center gap-1"
          (click)="filterPharmacyByOrderType('STAT')"
        >
          <span class="statlegend"></span>
          <label for="" class="form-label m-0">Stat</label>
        </div>
        <div
          class="d-flex align-items-center gap-1"
          (click)="filterPharmacyByOrderType('Discharge Medication')"
        >
          <span class="dischargelegend"></span>
          <label for="" class="form-label m-0">Discharge Medication</label>
        </div>
        <div
          class="d-flex align-items-center gap-1"
          (click)="filterPharmacyByOrderType('Normal')"
        >
          <span class="normallegend"></span>
          <label for="" class="form-label m-0">Normal</label>
        </div>
      </div>
    </div>
    <div class="tab-content pt-2 border-top-0" id="nav-tabContent">
      <div
        class="tab-pane"
        id="ServiceOrders"
        role="tabpanel"
        aria-labelledby=""
      >
        <div class="arCompStatementData_table notBilledSection">
          <ngx-datatable
            *ngIf="activeTab === 'ServiceOrders'"
            #serviceTable
            class="my-custom-table material"
            [rows]="NotBilledOrderList"
            [columnMode]="'force'"
            [headerHeight]="0"
            [footerHeight]="50"
            [rowHeight]="30"
            [limit]="50"
            [groupRowsBy]="'patientID'"
            [scrollbarH]="false"
            [groupExpansionDefault]="false"
          >
            <ngx-datatable-group-header>
              <ng-template
                let-group="group"
                ngx-datatable-group-header-template
              >
                <div class="cursor-pointer">
                  <div class="rounded NewRequest">
                    <div class="row gx-1 mx-0 align-items-center">
                      <div
                        (click)="toggleExpandGroup(group)"
                        class="bg-primary-50 rounded-start cursor-pointer position-relative"
                        style="width: 22rem"
                      >
                        <div class="p-2 doctor_profile d-flex">
                          <div class="text-center me-2">
                            <div class="profile_img position-relative">
                              <img
                                *ngIf="group.value[0]?.gender == 'Male'"
                                src="assets/images/icons/male.svg"
                                alt=""
                              />
                              <img
                                *ngIf="group.value[0]?.gender == 'Female'"
                                src="assets/images/icons/female.svg"
                                alt=""
                              />
                            </div>
                          </div>
                          <div
                            class="d-flex w-100 align-items-center justify-content-between"
                          >
                            <div class="w-100 position-relative">
                              <div class="custom_tooltip custom_tooltip_right">
                                <p
                                  class="m-0 value fs-7 fw-bold w-75 text-truncate clr-primary-600"
                                >
                                  {{ group.value[0]?.patientName }}
                                </p>
                                <div class="tooltip">
                                  <p class="m-0 value fs-7 fw-bold">
                                    {{ group.value[0]?.patientName }}
                                  </p>
                                </div>
                              </div>
                              <div class="d-flex align-items-center gap-3">
                                <div
                                  class="full_age_hover custom_tooltip custom_tooltip_right d-flex align-items-center gap-1"
                                >
                                  <p class="m-0">
                                    {{ group.value[0]?.gender }} |
                                    {{ group.value[0]?.fullAge }}
                                  </p>
                                </div>
                                <p class="m-0">
                                  <b>SSN</b> :
                                  <span>{{ group.value[0]?.ssn }}</span>
                                </p>
                              </div>
                              <div>
                                <p class="m-0">
                                  {{ group.value[0]?.nationality }} | Mobile :
                                  {{ group.value[0]?.mobileNo }}
                                </p>
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>

                      <div class="col doc_details">
                        <div class="p-1 rounded">
                          <div class="row gx-2 align-items-center">
                            <div class="col-1 d-flex flex-column">
                              <label class="form-label m-0 clr-grey fw-bold"
                                >Patient Type</label
                              >
                              <p
                                class="fw-bold m-0"
                                [ngSwitch]="group.value[0]?.patientType"
                              >
                                <span *ngSwitchCase="1">OP</span>
                                <span *ngSwitchCase="2">IP</span>
                                <span *ngSwitchCase="3">ED</span>
                                <span *ngSwitchCase="6">PHARMACY</span>
                                <span *ngSwitchDefault>-</span>
                              </p>
                            </div>
                            <div class="col-3 d-flex flex-column">
                              <label class="form-label m-0 clr-grey fw-bold"
                                >Payer</label
                              >
                              <p class="m-0">
                                {{
                                  group.value[0]?.insuranceCompanyName || "-"
                                }}
                              </p>
                            </div>
                            <div class="col-3 d-flex flex-column">
                              <label class="form-label m-0 clr-grey fw-bold"
                                >Company</label
                              >
                              <p class="m-0">
                                {{ group.value[0]?.companyName || "-" }}
                              </p>
                            </div>
                            <div class="col-1 d-flex flex-column">
                              <label class="form-label m-0 clr-grey fw-bold"
                                >Grade</label
                              >
                              <p class="m-0">
                                {{ group.value[0]?.gradeName || "-" }}
                              </p>
                            </div>

                            <div class="col-1 d-flex flex-column">
                              <label class="form-label m-0 clr-grey fw-bold"
                                >CTAS</label
                              >
                              <p class="fw-bold m-0">
                                {{ group.value[0]?.ctasScore || "-" }}
                              </p>
                            </div>

                            <div
                              class="col-2 d-flex flex-column"
                              style="width: 13%"
                            >
                              <label class="form-label m-0 clr-grey fw-bold"
                                >Bill Amount</label
                              >
                              <p class="fw-bold m-0">
                                {{ calculateBillAmount(group.value) }}
                              </p>
                            </div>

                            <div
                              class="col-2 d-flex gap-1 justify-content-end"
                              style="width: 10%"
                            >
                              <!-- <label class="form-label m-0 clr-grey fw-bold"
                                >Action</label
                              > -->
                              <div
                                class="custom_tooltip custom_tooltip_left"
                                [class.d-none]="group.value[0]?.companyID === 0"
                                (click)="viewApprovals(group.value[0])"
                              >
                                <svg
                                  class="cursor-pointer"
                                  width="28"
                                  height="28"
                                  viewBox="0 0 24 24"
                                  fill="none"
                                  xmlns="http://www.w3.org/2000/svg"
                                >
                                  <rect
                                    x="0.5"
                                    y="0.5"
                                    width="23"
                                    height="23"
                                    rx="11.5"
                                    fill="#DAEEF1"
                                  ></rect>
                                  <path
                                    d="M15.438 18.5H8.12549C7.45343 18.5 6.90674 17.9533 6.90674 17.2812V6.71875C6.90674 6.04669 7.45343 5.5 8.12549 5.5H15.438C16.11 5.5 16.6567 6.04669 16.6567 6.71875V12.4388C16.6567 12.6631 16.475 12.845 16.2505 12.845C16.026 12.845 15.8442 12.6631 15.8442 12.4388V6.71875C15.8442 6.49478 15.6622 6.3125 15.438 6.3125H8.12549C7.90132 6.3125 7.71924 6.49478 7.71924 6.71875V17.2812C7.71924 17.5052 7.90132 17.6875 8.12549 17.6875H15.438C15.4586 17.6875 15.4789 17.6857 15.4995 17.6819C15.7229 17.6395 15.9319 17.7885 15.972 18.009C16.0121 18.2298 15.8653 18.4413 15.6447 18.4814C15.5757 18.4939 15.507 18.5 15.438 18.5Z"
                                    fill="#43A9BC"
                                  ></path>
                                  <path
                                    d="M10.1552 9.9687C9.37723 9.9687 8.74405 9.33573 8.74405 8.55755C8.74405 7.77938 9.37723 7.14661 10.1552 7.14661C10.9332 7.14661 11.566 7.77958 11.566 8.55755C11.566 9.33552 10.9332 9.9687 10.1552 9.9687ZM10.1552 7.95907C9.82512 7.95907 9.55655 8.22743 9.55655 8.55751C9.55655 8.88759 9.82512 9.15616 10.1552 9.15616C10.4853 9.15616 10.7535 8.88759 10.7535 8.55751C10.7535 8.22743 10.4853 7.95907 10.1552 7.95907Z"
                                    fill="#43A9BC"
                                  ></path>
                                  <path
                                    d="M11.12 11.9783H9.18995C8.75949 11.9783 8.40918 11.628 8.40918 11.1974V10.9022C8.40918 9.93953 9.19231 9.15616 10.1552 9.15616C11.1181 9.15616 11.9012 9.93949 11.9012 10.9022V11.1974C11.9012 11.628 11.5509 11.9783 11.12 11.9783ZM9.22168 11.1658H11.0887V10.9022C11.0887 10.3875 10.6698 9.9687 10.1552 9.9687C9.6406 9.9687 9.22164 10.3875 9.22164 10.9022L9.22168 11.1658Z"
                                    fill="#43A9BC"
                                  ></path>
                                  <path
                                    d="M15.5536 16.3525C15.4461 16.3525 15.3425 16.3096 15.2664 16.2335L14.5388 15.5057C14.3801 15.347 14.3801 15.0897 14.5388 14.9312C14.6974 14.7725 14.9545 14.7725 15.1132 14.9312L15.5449 15.3628L16.5677 14.2754C16.722 14.1115 16.9787 14.1042 17.1421 14.2577C17.3056 14.4114 17.3131 14.6685 17.1596 14.832L15.8496 16.2245C15.7743 16.3046 15.6699 16.3506 15.56 16.3524L15.5536 16.3525Z"
                                    fill="#368796"
                                  ></path>
                                  <path
                                    d="M15.8448 18.4984C15.0125 18.4984 14.1801 18.1816 13.5465 17.548C12.2794 16.2809 12.2794 14.2191 13.5465 12.9519C14.8137 11.6847 16.8759 11.6848 18.1431 12.9519C19.4102 14.219 19.4102 16.2808 18.1431 17.548C17.5095 18.1816 16.6771 18.4984 15.8448 18.4984ZM15.8448 12.8136C15.2203 12.8136 14.5963 13.0513 14.121 13.5264C13.1708 14.4768 13.1708 16.0232 14.121 16.9736C15.0719 17.9237 16.6184 17.9233 17.5685 16.9736C18.5187 16.0232 18.5187 14.4768 17.5685 13.5264C17.0933 13.0513 16.4692 12.8136 15.8448 12.8136Z"
                                    fill="#368796"
                                  ></path>
                                  <path
                                    fill-rule="evenodd"
                                    clip-rule="evenodd"
                                    d="M14.6274 8.34375H13.0024C12.7779 8.34375 12.5962 8.16183 12.5962 7.9375C12.5962 7.71317 12.7779 7.53125 13.0024 7.53125H14.6274C14.852 7.53125 15.0337 7.71317 15.0337 7.9375C15.0337 8.16183 14.852 8.34375 14.6274 8.34375ZM14.6275 9.96876H13.0025C12.778 9.96876 12.5963 9.78684 12.5963 9.56251C12.5963 9.33818 12.778 9.15626 13.0025 9.15626H14.6275C14.8521 9.15626 15.0338 9.33818 15.0338 9.56251C15.0338 9.78684 14.8521 9.96876 14.6275 9.96876ZM13.0025 11.5938H14.6275C14.8521 11.5938 15.0338 11.4119 15.0338 11.1876C15.0338 10.9632 14.8521 10.7813 14.6275 10.7813H13.0025C12.778 10.7813 12.5963 10.9632 12.5963 11.1876C12.5963 11.4119 12.778 11.5938 13.0025 11.5938Z"
                                    fill="#43A9BC"
                                  ></path>
                                  <path
                                    fill-rule="evenodd"
                                    clip-rule="evenodd"
                                    d="M11.7808 13.6251H8.93701C8.71248 13.6251 8.53076 13.4431 8.53076 13.2188C8.53076 12.9945 8.71248 12.8126 8.93701 12.8126H11.7808C12.0053 12.8126 12.187 12.9945 12.187 13.2188C12.187 13.4431 12.0053 13.6251 11.7808 13.6251ZM11.3745 15.25H8.93701C8.71248 15.25 8.53076 15.0681 8.53076 14.8438C8.53076 14.6195 8.71248 14.4375 8.93701 14.4375H11.3745C11.599 14.4375 11.7808 14.6195 11.7808 14.8438C11.7808 15.0681 11.599 15.25 11.3745 15.25ZM8.93701 16.8751H11.7808C12.0053 16.8751 12.187 16.6932 12.187 16.4688C12.187 16.2445 12.0053 16.0626 11.7808 16.0626H8.93701C8.71248 16.0626 8.53076 16.2445 8.53076 16.4688C8.53076 16.6932 8.71248 16.8751 8.93701 16.8751Z"
                                    fill="#43A9BC"
                                  ></path>
                                  <rect
                                    x="0.5"
                                    y="0.5"
                                    width="23"
                                    height="23"
                                    rx="11.5"
                                    stroke="#8ECBD7"
                                  ></rect>
                                </svg>
                                <div class="tooltip">
                                  <p class="m-0">Approval</p>
                                </div>
                              </div>
                              <button
                                class="btn btn-main-outline"
                                (click)="
                                  opNavigation(group.value[0]?.patientID)
                                "
                              >
                                Bill
                              </button>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </ng-template>
            </ngx-datatable-group-header>

            <ngx-datatable-column [flexGrow]="1">
              <ng-template
                ngx-datatable-cell-template
                let-row="row"
                let-rowIndex="rowIndex"
              >
                <div class="row-wrapper">
                  <!-- Header (only on first row of group) -->
                  <ng-container *ngIf="isFirstRowInGroup(row)">
                    <div
                      class="custom-header"
                      style="
                        background-color: #ecf6f8 !important;
                        color: #438d9c !important;
                      "
                    >
                      <div class="row no-gutters fw-bold px-2 py-2">
                        <div class="col-2">Service Code</div>
                        <div class="col-2">Service Name</div>
                        <div class="col-2">Specialisation</div>
                        <div class="col-2">Price</div>
                        <div class="col-2">Status</div>
                      </div>
                    </div>
                  </ng-container>

                  <!-- Body Row -->
                  <div
                    class="custom-body px-2 py-2"
                    [ngStyle]="{
                      'background-color': getStripedColor(rowIndex)
                    }"
                  >
                    <div class="row no-gutters align-items-center">
                      <div class="col-2">{{ row.procedureCode }}</div>
                      <div class="col-2">{{ row.procedureName }}</div>
                      <div class="col-2">{{ row.specialisation }}</div>
                      <div class="col-2">{{ row.unitRate }}</div>
                      <div class="col-2">{{ row.statusName }}</div>
                    </div>
                  </div>
                </div>
              </ng-template>
            </ngx-datatable-column>
          </ngx-datatable>
        </div>
      </div>
      <!-- Not Billed Pharmacy orders -->
      <div
        class="tab-pane fade active show"
        id="PharmacyOrders"
        role="tabpanel"
        aria-labelledby=""
      >
        <div
          class="row gx-2 pharmacist_token rad mx-0 mt-1 mb-2"
          *ngIf="activeTab === 'PharmacyOrders' && !skelLoader2"
        >
          <div class="col-3 cursor-pointer">
            <div
              class="walkin_cards p-2 border shadow-sm green d-flex align-items-center"
              [class.active]="status === 'New Order'"
              (click)="filterPharmacyOrderByStatus('New Order')"
            >
              <div class="count total_token d-flex align-items-center gap-2">
                <h4 class="m-0 fw-bold" style="background-color: #13b9dd">
                  {{ NotBilledPharmacyOrderListCounts?.newOrder || 0 }}
                </h4>
                <p class="m-0 fs-7 fw-bold">New Order</p>
              </div>
            </div>
          </div>
          <div class="col-3 cursor-pointer">
            <div
              class="walkin_cards p-2 border shadow-sm green d-flex align-items-center"
              [class.active]="status === 'Partially Issued'"
              (click)="filterPharmacyOrderByStatus('Partially Issued')"
            >
              <div class="count total_token d-flex align-items-center gap-2">
                <h4 class="m-0 fw-bold" style="background-color: #75a47f">
                  {{ NotBilledPharmacyOrderListCounts?.partiallyIssued || 0 }}
                </h4>
                <p class="m-0 fs-7 fw-bold">Partially Issued</p>
              </div>
            </div>
          </div>
          <div class="col-3 cursor-pointer">
            <div
              class="walkin_cards p-2 border shadow-sm green d-flex align-items-center"
              [class.active]="status === 'Fully Issued'"
              (click)="filterPharmacyOrderByStatus('Fully Issued')"
            >
              <div class="count total_token d-flex align-items-center gap-2">
                <h4 class="m-0 fw-bold" style="background-color: #d8cd82">
                  {{ NotBilledPharmacyOrderListCounts?.fullyIssued || 0 }}
                </h4>
                <p class="m-0 fs-7 fw-bold">Fully Issued</p>
              </div>
            </div>
          </div>
        </div>

        <div class="arCompStatementData_table notBilledSection">
          <ngx-datatable
            *ngIf="activeTab === 'PharmacyOrders'"
            #pharmacyTable
            class="my-custom-table material"
            [rows]="NotBilledPharmacyOrderList"
            [columnMode]="'force'"
            [headerHeight]="0"
            [footerHeight]="50"
            [rowHeight]="50"
            [limit]="100"
            [groupRowsBy]="'admissionid'"
            [scrollbarH]="false"
            [groupExpansionDefault]="false"
          >
            <ngx-datatable-group-header>
              <ng-template
                let-group="group"
                ngx-datatable-group-header-template
              >
                <div
                  class="doc_card rounded cursor-pointer m-0"
                  [ngStyle]="{
                    borderLeft:
                      group.value[0]?.orderStatus === 'Discharge Medication'
                        ? '4px solid #ff9637'
                        : group.value[0]?.orderStatus === 'STAT'
                        ? '4px solid #e30000'
                        : group.value[0]?.orderStatus === 'Normal'
                        ? '4px solid green'
                        : '4px solid #ccc'
                  }"
                >
                  <div class="rounded newOrder">
                    <div class="row gx-1 mx-0 align-items-center">
                      <div
                        (click)="toggleExpandGroup2(group)"
                        class="bg-primary-50 rounded-start cursor-pointer position-relative col-2"
                        style="width: 20%"
                      >
                        <div class="p-2 doctor_profile d-flex">
                          <div class="text-center me-2">
                            <div class="profile_img position-relative">
                              <img
                                *ngIf="group.value[0]?.gender == 'Male'"
                                src="assets/images/icons/male.svg"
                                alt=""
                              />
                              <img
                                *ngIf="group.value[0]?.gender == 'Female'"
                                src="assets/images/icons/female.svg"
                                alt=""
                              />
                            </div>
                          </div>
                          <div
                            class="d-flex w-100 align-items-center justify-content-between"
                          >
                            <div class="w-100 position-relative">
                              <div class="custom_tooltip custom_tooltip_right">
                                <p
                                  class="m-0 value fs-7 fw-bold w-75 text-truncate clr-primary-600"
                                  style="white-space: nowrap !important"
                                >
                                  {{ group.value[0]?.patientName }}
                                </p>
                                <div class="tooltip">
                                  <p class="m-0 value fs-7 fw-bold">
                                    {{ group.value[0]?.patientName }}
                                  </p>
                                </div>
                              </div>
                              <div class="d-flex align-items-center gap-3">
                                <div
                                  class="full_age_hover custom_tooltip custom_tooltip_right d-flex align-items-center gap-1"
                                >
                                  <p class="m-0">
                                    {{ group.value[0]?.gender }} |
                                    {{ group.value[0]?.fullAge }}
                                  </p>
                                </div>
                                <p class="m-0">
                                  <b>SSN</b> :
                                  <span>{{ group.value[0]?.ssn }}</span>
                                </p>
                              </div>
                              <div>
                                <p class="m-0">
                                  {{ group.value[0]?.nationality }} | Mobile :
                                  {{ group.value[0]?.mobileNo }}
                                </p>
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>

                      <div class="doc_details" style="width: 80%">
                        <div class="p-1 rounded">
                          <div class="row gx-2">
                            <div
                              class="col-1 d-flex flex-column"
                              style="width: 5%"
                            >
                              <label class="form-label m-0 clr-grey fw-bold"
                                >Bed</label
                              >
                              <p
                                class="fw-bold m-0"
                                [ngSwitch]="group.value[0]?.patientType"
                              >
                                {{ group.value[0]?.bedName || "-" }}
                              </p>
                            </div>
                            <div
                              class="col-3 d-flex flex-column"
                              style="width: 15%"
                            >
                              <label class="form-label m-0 clr-grey fw-bold"
                                >Payer</label
                              >
                              <p class="m-0 text-wrap">
                                {{
                                  group.value[0]?.insuranceCompanyName || "-"
                                }}
                              </p>
                            </div>
                            <div
                              class="col-3 d-flex flex-column"
                              style="width: 15%"
                            >
                              <label class="form-label m-0 clr-grey fw-bold"
                                >Company</label
                              >
                              <p class="m-0 text-wrap">
                                {{ group.value[0]?.companyName || "-" }}
                              </p>
                            </div>
                            <div
                              class="col-1 d-flex flex-column"
                              style="width: 5%"
                            >
                              <label class="form-label m-0 clr-grey fw-bold"
                                >Grade</label
                              >
                              <p class="m-0">
                                {{ group.value[0]?.gradeName || "-" }}
                              </p>
                            </div>

                            <div
                              class="col-1 d-flex flex-column"
                              style="width: 5%"
                            >
                              <label class="form-label m-0 clr-grey fw-bold"
                                >CTAS</label
                              >
                              <p class="fw-bold m-0">
                                {{ group.value[0]?.ctasScore || "-" }}
                              </p>
                            </div>
                            <div
                              class="col-1 d-flex flex-column"
                              style="width: 12%"
                            >
                              <label class="form-label m-0 clr-grey fw-bold"
                                >Prescribed Date</label
                              >
                              <p class="fw-bold m-0">
                                {{
                                  group.value[0]?.prescriptionDate || ""
                                    | date : "dd-MMM-yyyy HH:mm"
                                }}
                              </p>
                            </div>
                            <div
                              class="col-1 d-flex flex-column"
                              style="width: 10%"
                            >
                              <label class="form-label m-0 clr-grey fw-bold"
                                >Billed Date</label
                              >
                              <p class="fw-bold m-0">
                                {{
                                  group.value[0]?.lastIssueDate || ""
                                    | date : "dd-MMM-yyyy HH:mm"
                                }}
                              </p>
                            </div>
                            <!-- <div class="col-1 d-flex flex-column" style="width: 10%;">
                              <label class="form-label m-0 clr-grey fw-bold"
                                >Dispatch Datetime</label
                              >
                              <p class="fw-bold m-0">
                                
                              </p>
                            </div> -->

                            <div
                              class="col-2 d-flex flex-column inline_legend"
                              style="width: 10%"
                            >
                              <!-- <label class="form-label m-0 clr-grey fw-bold"
                                >Status</label
                              > -->
                              <span class="m-0">
                                {{ getPatientStatusLabel(group.key) }}
                              </span>
                            </div>

                            <div
                              class="col-2 d-flex gap-1 justify-content-end align-items-center"
                              style="width: 10%"
                            >
                              <!-- <label class="form-label m-0 clr-grey fw-bold"
                                >Action</label
                              > -->
                              <div
                                class="custom_tooltip custom_tooltip_left"
                                [class.d-none]="group.value[0]?.companyID === 0"
                                (click)="viewApprovals(group.value[0])"
                              >
                                <svg
                                  class="cursor-pointer"
                                  width="28"
                                  height="28"
                                  viewBox="0 0 24 24"
                                  fill="none"
                                  xmlns="http://www.w3.org/2000/svg"
                                >
                                  <rect
                                    x="0.5"
                                    y="0.5"
                                    width="23"
                                    height="23"
                                    rx="11.5"
                                    fill="#DAEEF1"
                                  ></rect>
                                  <path
                                    d="M15.438 18.5H8.12549C7.45343 18.5 6.90674 17.9533 6.90674 17.2812V6.71875C6.90674 6.04669 7.45343 5.5 8.12549 5.5H15.438C16.11 5.5 16.6567 6.04669 16.6567 6.71875V12.4388C16.6567 12.6631 16.475 12.845 16.2505 12.845C16.026 12.845 15.8442 12.6631 15.8442 12.4388V6.71875C15.8442 6.49478 15.6622 6.3125 15.438 6.3125H8.12549C7.90132 6.3125 7.71924 6.49478 7.71924 6.71875V17.2812C7.71924 17.5052 7.90132 17.6875 8.12549 17.6875H15.438C15.4586 17.6875 15.4789 17.6857 15.4995 17.6819C15.7229 17.6395 15.9319 17.7885 15.972 18.009C16.0121 18.2298 15.8653 18.4413 15.6447 18.4814C15.5757 18.4939 15.507 18.5 15.438 18.5Z"
                                    fill="#43A9BC"
                                  ></path>
                                  <path
                                    d="M10.1552 9.9687C9.37723 9.9687 8.74405 9.33573 8.74405 8.55755C8.74405 7.77938 9.37723 7.14661 10.1552 7.14661C10.9332 7.14661 11.566 7.77958 11.566 8.55755C11.566 9.33552 10.9332 9.9687 10.1552 9.9687ZM10.1552 7.95907C9.82512 7.95907 9.55655 8.22743 9.55655 8.55751C9.55655 8.88759 9.82512 9.15616 10.1552 9.15616C10.4853 9.15616 10.7535 8.88759 10.7535 8.55751C10.7535 8.22743 10.4853 7.95907 10.1552 7.95907Z"
                                    fill="#43A9BC"
                                  ></path>
                                  <path
                                    d="M11.12 11.9783H9.18995C8.75949 11.9783 8.40918 11.628 8.40918 11.1974V10.9022C8.40918 9.93953 9.19231 9.15616 10.1552 9.15616C11.1181 9.15616 11.9012 9.93949 11.9012 10.9022V11.1974C11.9012 11.628 11.5509 11.9783 11.12 11.9783ZM9.22168 11.1658H11.0887V10.9022C11.0887 10.3875 10.6698 9.9687 10.1552 9.9687C9.6406 9.9687 9.22164 10.3875 9.22164 10.9022L9.22168 11.1658Z"
                                    fill="#43A9BC"
                                  ></path>
                                  <path
                                    d="M15.5536 16.3525C15.4461 16.3525 15.3425 16.3096 15.2664 16.2335L14.5388 15.5057C14.3801 15.347 14.3801 15.0897 14.5388 14.9312C14.6974 14.7725 14.9545 14.7725 15.1132 14.9312L15.5449 15.3628L16.5677 14.2754C16.722 14.1115 16.9787 14.1042 17.1421 14.2577C17.3056 14.4114 17.3131 14.6685 17.1596 14.832L15.8496 16.2245C15.7743 16.3046 15.6699 16.3506 15.56 16.3524L15.5536 16.3525Z"
                                    fill="#368796"
                                  ></path>
                                  <path
                                    d="M15.8448 18.4984C15.0125 18.4984 14.1801 18.1816 13.5465 17.548C12.2794 16.2809 12.2794 14.2191 13.5465 12.9519C14.8137 11.6847 16.8759 11.6848 18.1431 12.9519C19.4102 14.219 19.4102 16.2808 18.1431 17.548C17.5095 18.1816 16.6771 18.4984 15.8448 18.4984ZM15.8448 12.8136C15.2203 12.8136 14.5963 13.0513 14.121 13.5264C13.1708 14.4768 13.1708 16.0232 14.121 16.9736C15.0719 17.9237 16.6184 17.9233 17.5685 16.9736C18.5187 16.0232 18.5187 14.4768 17.5685 13.5264C17.0933 13.0513 16.4692 12.8136 15.8448 12.8136Z"
                                    fill="#368796"
                                  ></path>
                                  <path
                                    fill-rule="evenodd"
                                    clip-rule="evenodd"
                                    d="M14.6274 8.34375H13.0024C12.7779 8.34375 12.5962 8.16183 12.5962 7.9375C12.5962 7.71317 12.7779 7.53125 13.0024 7.53125H14.6274C14.852 7.53125 15.0337 7.71317 15.0337 7.9375C15.0337 8.16183 14.852 8.34375 14.6274 8.34375ZM14.6275 9.96876H13.0025C12.778 9.96876 12.5963 9.78684 12.5963 9.56251C12.5963 9.33818 12.778 9.15626 13.0025 9.15626H14.6275C14.8521 9.15626 15.0338 9.33818 15.0338 9.56251C15.0338 9.78684 14.8521 9.96876 14.6275 9.96876ZM13.0025 11.5938H14.6275C14.8521 11.5938 15.0338 11.4119 15.0338 11.1876C15.0338 10.9632 14.8521 10.7813 14.6275 10.7813H13.0025C12.778 10.7813 12.5963 10.9632 12.5963 11.1876C12.5963 11.4119 12.778 11.5938 13.0025 11.5938Z"
                                    fill="#43A9BC"
                                  ></path>
                                  <path
                                    fill-rule="evenodd"
                                    clip-rule="evenodd"
                                    d="M11.7808 13.6251H8.93701C8.71248 13.6251 8.53076 13.4431 8.53076 13.2188C8.53076 12.9945 8.71248 12.8126 8.93701 12.8126H11.7808C12.0053 12.8126 12.187 12.9945 12.187 13.2188C12.187 13.4431 12.0053 13.6251 11.7808 13.6251ZM11.3745 15.25H8.93701C8.71248 15.25 8.53076 15.0681 8.53076 14.8438C8.53076 14.6195 8.71248 14.4375 8.93701 14.4375H11.3745C11.599 14.4375 11.7808 14.6195 11.7808 14.8438C11.7808 15.0681 11.599 15.25 11.3745 15.25ZM8.93701 16.8751H11.7808C12.0053 16.8751 12.187 16.6932 12.187 16.4688C12.187 16.2445 12.0053 16.0626 11.7808 16.0626H8.93701C8.71248 16.0626 8.53076 16.2445 8.53076 16.4688C8.53076 16.6932 8.71248 16.8751 8.93701 16.8751Z"
                                    fill="#43A9BC"
                                  ></path>
                                  <rect
                                    x="0.5"
                                    y="0.5"
                                    width="23"
                                    height="23"
                                    rx="11.5"
                                    stroke="#8ECBD7"
                                  ></rect>
                                </svg>
                                <div class="tooltip">
                                  <p class="m-0">Approval</p>
                                </div>
                              </div>
                              <button
                                class="btn btn-main-outline"
                                (click)="opNavigation(group.value[0])"
                              >
                                Bill
                              </button>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </ng-template>
            </ngx-datatable-group-header>

            <ngx-datatable-column [flexGrow]="1">
              <ng-template
                ngx-datatable-cell-template
                let-row="row"
                let-rowIndex="rowIndex"
              >
                <div class="row-wrapper">
                  <!-- Header (only on first row of group) -->
                  <ng-container *ngIf="isFirstRowInGroup(row)">
                    <div
                      class="custom-header"
                      style="
                        background-color: #ecf6f8 !important;
                        color: #438d9c !important;
                      "
                    >
                      <div class="row no-gutters fw-bold px-2 py-2">
                        <div class="col-4">Drug Name</div>
                        <div class="col-1">Dose</div>
                        <div class="col-1">Route</div>
                        <div class="col-1">Frequency</div>
                        <div class="col-1">Duration</div>
                        <div class="col-1">Pres. Quantity</div>
                        <div class="col-1">Issued Quantity</div>
                      </div>
                    </div>
                  </ng-container>

                  <!-- Body Row -->
                  <div
                    class="custom-body px-2 py-2"
                    [ngStyle]="{
                      'background-color': getStripedColor(rowIndex)
                    }"
                  >
                    <div class="row no-gutters align-items-center">
                      <div class="col-4">{{ row.itemName }}</div>
                      <div class="col-1">{{ row.dose }}-{{ row.doseUoM }}</div>
                      <div class="col-1">{{ row.admRoute }}</div>
                      <div class="col-1">{{ row.frequency }}</div>
                      <div class="col-1">
                        {{ row.duration + " " + row.durationUOM }}
                      </div>
                      <div class="col-1">
                        {{ row.prescribedQty + " " + row.prescribedQtyUOM }}
                      </div>
                      <div class="col-1">
                        {{ row.issuedQtyLowest + " " + row.lowestUOM }}
                      </div>
                    </div>
                  </div>
                </div>
              </ng-template>
            </ngx-datatable-column>
          </ngx-datatable>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="modal packageDoctor_modal" id="viewApprovalsModal">
  <div class="modal-dialog modal-dialog-centered" style="max-width: 95%">
    <div class="modal-content">
      <div class="modal-header justify-content-between">
        <h5 class="modal-title m-0">View Approvals</h5>
        <div class="d-flex align-items-center gap-2">
          <button
            type="button"
            class="btn-close"
            data-bs-dismiss="modal"
            aria-label="Close"
          ></button>
        </div>
      </div>
      <div class="modal-body">
        <div class="doc_card rounded cursor-pointer">
          <div class="rounded NewRequest">
            <div class="row gx-1 mx-0 align-items-center">
              <div
                class="bg-primary-50 rounded-start cursor-pointer position-relative"
                style="width: 22rem"
              >
                <div class="p-2 doctor_profile d-flex">
                  <div class="text-center me-2">
                    <div class="profile_img position-relative">
                      <img src="assets/images/icons/male.svg" alt="" class="" />
                    </div>
                  </div>
                  <div
                    class="d-flex w-100 align-items-center justify-content-between"
                  >
                    <div class="w-100 position-relative">
                      <div class="custom_tooltip custom_tooltip_right">
                        <p
                          class="m-0 value fs-7 fw-bold w-75 text-truncate clr-primary-600"
                        >
                          {{ selectedPtForApproval?.patientName }}
                        </p>
                        <div class="tooltip">
                          <p class="m-0 value fs-7 fw-bold">
                            {{ selectedPtForApproval?.patientName }}
                          </p>
                        </div>
                      </div>
                      <div class="d-flex align-items-center gap-3">
                        <div
                          class="full_age_hover custom_tooltip custom_tooltip_right d-flex align-items-center gap-1"
                        >
                          <p class="m-0">
                            {{ selectedPtForApproval?.gender }} |
                            {{ selectedPtForApproval?.fullAge }}
                          </p>
                        </div>
                        <p class="m-0">
                          <b>SSN</b> :
                          <span>{{ selectedPtForApproval?.ssn }}</span>
                        </p>
                      </div>
                      <div>
                        <p class="m-0">
                          {{ selectedPtForApproval?.nationality }} | Mobile :
                          {{ selectedPtForApproval?.mobileNo }}
                        </p>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <div class="col doc_details">
                <div class="p-1 rounded">
                  <div class="row gx-2">
                    <div class="col-1 d-flex flex-column">
                      <label class="form-label m-0 clr-grey fw-bold"
                        >Patient Type</label
                      >
                      <p
                        class="fw-bold m-0"
                        [ngSwitch]="selectedPtForApproval?.patientType"
                      >
                        <span *ngSwitchCase="1">OP</span>
                        <span *ngSwitchCase="2">IP</span>
                        <span *ngSwitchCase="3">ED</span>
                        <span *ngSwitchCase="6">PHARMACY</span>
                        <span *ngSwitchDefault>-</span>
                      </p>
                    </div>
                    <div class="col-3 d-flex flex-column">
                      <label class="form-label m-0 clr-grey fw-bold"
                        >Payer</label
                      >
                      <p class="m-0">
                        {{ selectedPtForApproval?.insuranceCompanyName || "-" }}
                      </p>
                    </div>
                    <div class="col-3 d-flex flex-column">
                      <label class="form-label m-0 clr-grey fw-bold"
                        >Company</label
                      >
                      <p class="m-0">
                        {{ selectedPtForApproval?.companyName || "-" }}
                      </p>
                    </div>
                    <div class="col-1 d-flex flex-column">
                      <label class="form-label m-0 clr-grey fw-bold"
                        >Grade</label
                      >
                      <p class="m-0">
                        {{ selectedPtForApproval?.gradeName || "-" }}
                      </p>
                    </div>
                    <div class="col-1 d-flex flex-column">
                      <label class="form-label m-0 clr-grey fw-bold"
                        >CTAS</label
                      >
                      <p class="m-0">
                        {{ selectedPtForApproval?.ctasScore || "-" }}
                      </p>
                    </div>
                    <!-- <div class="col-2 d-flex flex-column" style="width: 13%;">
                            <label class="form-label m-0 clr-grey fw-bold">Bill Amount</label>
                            <p class="m-0"> {{
                              calculateBillAmount(selectedPtForApproval) | customPriceFormat
                            }} </p>
                          </div> -->
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <table class="table table_alter mb-0 mt-3">
          <thead>
            <tr>
              <th>Service Name</th>
              <th>Item Name</th>
              <th>Quantity</th>
              <th>Price</th>
              <th>Status</th>
              <th>Requested Date</th>
              <!-- <th>Nphies Status</th> -->
              <th>Approved Amount</th>
              <!-- <th>More info</th> -->
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let req of aprrovalRequestDetails; let i = index">
              <td>{{ req.ServiceName }}</td>
              <td>{{ req.ItemName }}</td>
              <td>{{ req.Quantity }}</td>
              <td>{{ req.Price }}</td>
              <!-- <td>{{ req.StatusName }}</td> -->
              <td>
                <div class="col">
                  <div class="d-flex align-items-center gap-2">
                    <svg
                      xmlns="http://www.w3.org/2000/svg"
                      width="16"
                      height="16"
                      viewBox="0 0 16 16"
                      fill="none"
                    >
                      <path
                        fill-rule="evenodd"
                        clip-rule="evenodd"
                        d="M13.8552 1.56632H13.131V1.39789C13.131 0.623158 12.5079 0 11.7331 0C10.9584 0 10.3352 0.623158 10.3352 1.39789V1.56632H9.24049V1.39789C9.24049 0.623158 8.61733 0 7.84259 0C7.06785 0 6.4447 0.623158 6.4447 1.39789V1.56632H5.34996V1.39789C5.34996 0.623158 4.7268 0 3.95206 0C3.17733 0 2.55417 0.623158 2.55417 1.39789V1.56632H1.82996C0.886801 1.56632 0.128906 2.32421 0.128906 3.26737V14.2989C0.128906 15.2421 0.886801 16 1.82996 16H13.8215C14.7647 16 15.5226 15.2421 15.5226 14.2989V3.28421C15.5563 2.34105 14.7984 1.56632 13.8552 1.56632ZM11.2279 1.41474C11.2279 1.12842 11.4636 0.909474 11.7331 0.909474C12.0194 0.909474 12.2384 1.14526 12.2384 1.41474V2.62737C12.2384 2.91368 12.0026 3.13263 11.7331 3.13263C11.4468 3.13263 11.2279 2.89684 11.2279 2.62737V1.41474ZM7.35417 1.41474C7.35417 1.12842 7.58996 0.909474 7.85943 0.909474C8.14575 0.909474 8.3647 1.14526 8.3647 1.41474V2.62737C8.3647 2.91368 8.12891 3.13263 7.85943 3.13263C7.57312 3.13263 7.35417 2.89684 7.35417 2.62737V1.41474ZM3.46364 1.41474C3.46364 1.12842 3.69943 0.909474 3.96891 0.909474C4.25522 0.909474 4.47417 1.14526 4.47417 1.41474V2.62737C4.47417 2.91368 4.23838 3.13263 3.96891 3.13263C3.68259 3.13263 3.46364 2.89684 3.46364 2.62737V1.41474ZM14.6805 14.3158C14.6805 14.7705 14.31 15.1411 13.8552 15.1411H1.86364C1.40891 15.1411 1.03838 14.7705 1.03838 14.3158V5.38947H14.6636V14.3158H14.6805ZM10.9753 13.3221C11.0932 13.44 11.2279 13.4905 11.3795 13.4905C11.5311 13.4905 11.6658 13.44 11.7837 13.3221L13.3332 11.7726C13.5521 11.5537 13.5521 11.1832 13.3332 10.9642C13.1142 10.7453 12.7437 10.7453 12.5248 10.9642L11.3795 12.1095L10.9584 11.6884C10.7395 11.4695 10.369 11.4695 10.15 11.6884C9.93107 11.9074 9.93107 12.2779 10.15 12.4968L10.9753 13.3221ZM4.92888 9.7179H3.19414C2.95835 9.7179 2.75625 9.51579 2.75625 9.28V7.52842C2.75625 7.29263 2.95835 7.09053 3.19414 7.09053H4.92888C5.16467 7.09053 5.36678 7.29263 5.36678 7.52842V9.28C5.36678 9.51579 5.16467 9.7179 4.92888 9.7179ZM7.0006 9.7179H8.73533C8.97112 9.7179 9.17323 9.51579 9.17323 9.28V7.52842C9.17323 7.29263 8.97112 7.09053 8.73533 7.09053H7.0006C6.76481 7.09053 6.5627 7.29263 6.5627 7.52842V9.28C6.54586 9.51579 6.74796 9.7179 7.0006 9.7179ZM12.5247 9.7179H10.79C10.5542 9.7179 10.3521 9.51579 10.3521 9.28V7.52842C10.3521 7.29263 10.5542 7.09053 10.79 7.09053H12.5247C12.7605 7.09053 12.9626 7.29263 12.9626 7.52842V9.28C12.9626 9.51579 12.7605 9.7179 12.5247 9.7179ZM3.19414 13.4569H4.92888C5.16467 13.4569 5.36678 13.2548 5.36678 13.019V11.2674C5.36678 11.0316 5.16467 10.8295 4.92888 10.8295H3.19414C2.95835 10.8295 2.75625 11.0316 2.75625 11.2674V13.019C2.75625 13.2548 2.95835 13.4569 3.19414 13.4569ZM8.73533 13.4569H7.0006C6.74796 13.4569 6.54586 13.2548 6.5627 13.019V11.2674C6.5627 11.0316 6.76481 10.8295 7.0006 10.8295H8.73533C8.97112 10.8295 9.17323 11.0316 9.17323 11.2674V13.019C9.17323 13.2548 8.97112 13.4569 8.73533 13.4569Z"
                        fill="#7C8283"
                      />
                    </svg>
                    <p>{{ req?.CREATEDATE }}</p>

                    <svg
                      xmlns="http://www.w3.org/2000/svg"
                      width="17"
                      height="16"
                      viewBox="0 0 17 16"
                      fill="none"
                    >
                      <path
                        d="M11.1608 9.78246H8.17179C7.67948 9.78246 7.29267 9.39565 7.29267 8.90334V4.33191C7.29267 3.83961 7.67948 3.45279 8.17179 3.45279C8.6641 3.45279 9.05091 3.83961 9.05091 4.33191V8.02422H11.1608C11.6531 8.02422 12.0399 8.41104 12.0399 8.90334C12.0399 9.39565 11.6531 9.78246 11.1608 9.78246Z"
                        fill="#7C8283"
                      />
                      <path
                        fill-rule="evenodd"
                        clip-rule="evenodd"
                        d="M16.5234 8C16.5234 12.4132 12.9366 16 8.52344 16C4.11025 16 0.523438 12.4132 0.523438 8C0.523438 3.58681 4.11025 0 8.52344 0C12.9366 0 16.5234 3.58681 16.5234 8ZM14.7652 8C14.7652 4.55385 11.9696 1.75824 8.52344 1.75824C5.07728 1.75824 2.28168 4.55385 2.28168 8C2.28168 11.4462 5.07728 14.2418 8.52344 14.2418C11.9696 14.2418 14.7652 11.4462 14.7652 8Z"
                        fill="#7C8283"
                      />
                    </svg>
                    <p>{{ req?.CREATEDATETIME }}</p>
                  </div>
                </div>
              </td>
              <td>
                <div [class]="req.class">
                  <p class="m-0">{{ req.StatusName }}</p>
                </div>
              </td>
              <td>{{ req.LimitApprovalAmount }}</td>
              <!-- <td></td> -->
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>

<div class="loader-wrapper" *ngIf="loader">
  <div class="loader">
    <div class="bar1"></div>
    <div class="bar2"></div>
    <div class="bar3"></div>
    <div class="bar4"></div>
    <div class="bar5"></div>
    <div class="bar6"></div>
    <div class="bar1"></div>
  </div>
</div>
